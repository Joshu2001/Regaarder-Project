import{r as f,j as t,g as F}from"./index-CVpeJt5r.js";import{u as $}from"./navigation-C4DKzRs6.js";import{L as M}from"./lightbulb-CiqIREr2.js";import{M as T,F as O,P}from"./pencil-g6xkndFt.js";import{H as V}from"./home-CvLImcbo.js";const _=typeof window<"u"&&localStorage.getItem("regaarder_language")||"English",g=r=>F(r,_),E="likedVideos",R=typeof window<"u"?window.__BACKEND_URL__||`${window.location.protocol}//${window.location.hostname}:4000`:"http://localhost:4000";async function X(r){try{if(!r||!r.videoId)return;const d=localStorage.getItem(E),a=d?JSON.parse(d):[],i=a.findIndex(m=>m.videoId===r.videoId);if(r.liked){const m={videoId:r.videoId,url:r.url||null,title:r.title||null,creatorName:r.creatorName||null,imageUrl:r.imageUrl||null,likedAt:r.timestamp||new Date().toISOString()};i>=0?a[i]=m:a.unshift(m)}else i>=0&&a.splice(i,1);localStorage.setItem(E,JSON.stringify(a.slice(0,500)));try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:a.length}}))}catch{}try{const m=localStorage.getItem("regaarder_token");m&&await fetch(`${R}/likes`,{method:r.liked?"POST":"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({videoId:r.videoId})})}catch(m){console.warn("Failed to sync like to backend",m)}}catch{}}function K(){try{localStorage.removeItem(E)}catch{}try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:0}}))}catch{}}function C(){try{const r=localStorage.getItem(E);return(r?JSON.parse(r):[]).sort((a,i)=>String(i.likedAt).localeCompare(String(a.likedAt)))}catch{return[]}}function B(r){return new Date(r).toLocaleString()}function G(){const r=$(),[d,a]=f.useState(()=>C()),[i,m]=f.useState({}),[y,s]=f.useState(""),[l,L]=f.useState(()=>{try{return localStorage.getItem("darkMode")==="true"}catch{return!1}});f.useRef(null);const p=f.useRef({}),[v,k]=f.useState({}),b=(e,n)=>k(u=>({...u,[e]:n})),U=e=>{try{X({videoId:e,liked:!1})}catch{}a(C()),k(n=>{const u={...n};return delete u[e],u});try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:C().length}}))}catch{}};f.useEffect(()=>{const e=()=>a(C());window.addEventListener("likes:updated",e);const n=setInterval(e,5e3);return()=>{window.removeEventListener("likes:updated",e),clearInterval(n)}},[]),f.useEffect(()=>{let e=!0;const n=async()=>{try{const h=await fetch(`${R}/videos`).catch(()=>null),N=h&&h.ok?await h.json():null,w=N&&N.videos||[],I={},c={};w.forEach(o=>{if(!o)return;o.id&&(I[o.id]=o),o.videoUrl&&(I[o.videoUrl]=o),o.url&&(I[o.url]=o);const x=(o.title||"").toLowerCase().trim();x&&(c[x]=o)}),e&&m({byKey:I,byTitle:c})}catch{}};n();const u=setInterval(n,1e4);return()=>{e=!1,clearInterval(u)}},[]);const j=f.useMemo(()=>{const e=(y||"").trim().toLowerCase();return e?d.filter(n=>(n.title||"").toLowerCase().includes(e)||(n.creatorName||"").toLowerCase().includes(e)||(n.url||"").toLowerCase().includes(e)):d},[d,y]),A=e=>{const n=e.url||e.videoId,u=e.title||"";try{const h={url:n,title:u,creatorName:e.creatorName};localStorage.setItem("miniPlayerData",JSON.stringify(h))}catch{}try{const h=`/videoplayer?src=${encodeURIComponent(n||"")}&title=${encodeURIComponent(u||"")}`;window.location.href=h}catch{r("/videoplayer")}};return t.jsxs("div",{style:{minHeight:"100vh",background:l?"#0e0e0e":"#f9fafb"},children:[t.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-lg font-semibold",style:{color:l?"#fff":"#111"},children:g("Liked Videos")}),d.length>0&&t.jsx("button",{onClick:()=>{K(),a([])},className:"text-sm font-medium hover:opacity-80 transition duration-150",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:g("Clear All")})]}),t.jsxs("div",{className:"mt-4 flex gap-3 items-center",children:[t.jsx("input",{value:y,onChange:e=>s(e.target.value),placeholder:g("Search liked videos"),className:"flex-1 px-3 py-2 rounded-md",style:{background:l?"#0b0b0b":"#fff",color:l?"#fff":"#111",border:"1px solid "+(l?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.08)")}}),t.jsxs("span",{className:"text-sm",style:{color:l?"#9ca3af":"#6b7280"},children:[j.length," ",j.length===1?g("video"):g("videos")]})]}),d.length>0&&t.jsxs("div",{className:"mt-3 rounded-lg p-3 flex items-center gap-2",style:{background:l?"rgba(250,204,21,0.08)":"#FEF9C3",border:"1px solid "+(l?"rgba(250,204,21,0.25)":"#FDE68A")},children:[t.jsx(M,{className:"w-4 h-4",style:{color:"#ca8a04"}}),t.jsx("div",{className:"text-xs",style:{color:l?"#fcd34d":"#92400E"},children:g("Swipe left to remove from Liked Videos")})]}),t.jsxs("div",{className:"mt-5 w-full space-y-4",children:[j.length===0&&t.jsx("div",{className:"text-sm",style:{color:l?"#9ca3af":"#6b7280"},children:g("No likes yet. Tap the heart in the player to add videos here.")}),j.map(e=>{const n=e.title||e.url||e.videoId,u=e.creatorName||"",h=i&&i.byKey?i.byKey:i,N=i&&i.byTitle?i.byTitle:{},w=e.videoId&&h[e.videoId]||e.url&&h[e.url]||n&&N[n.toLowerCase()],I=e.imageUrl||w&&(w.imageUrl||w.thumbnail||w.image)||"https://placehold.co/160x90/efefef/777?text=Video";return t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:c=>{const o=p.current[e.videoId];o&&o.moved||A(e)},onPointerDown:c=>{const o=c.clientX??(c.touches&&c.touches[0]?.clientX);p.current[e.videoId]={dragging:!0,startX:o,moved:!1}},onPointerMove:c=>{const o=p.current[e.videoId];if(!o||!o.dragging)return;const x=c.clientX??(c.touches&&c.touches[0]?.clientX);if(typeof x!="number")return;const S=x-o.startX;Math.abs(S)>3&&(o.moved=!0);const D=Math.min(0,S);b(e.videoId,Math.max(-240,D))},onPointerUp:c=>{if(!p.current[e.videoId])return;const x=v[e.videoId]||0;p.current[e.videoId]={dragging:!1,startX:0,moved:!1},x<=-80?(b(e.videoId,-320),setTimeout(()=>U(e.videoId),120)):b(e.videoId,0)},style:{transform:`translateX(${v[e.videoId]||0}px)`,transition:p.current[e.videoId]?.dragging?"none":"transform 220ms ease",opacity:(v[e.videoId]||0)<0?.98:1,touchAction:"pan-y"},children:[t.jsx("img",{src:I,alt:n,className:"w-40 h-24 object-cover rounded-md",onError:c=>{c.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:n}),u&&t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["@",u]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[g("Liked")," â€¢ ",B(e.likedAt)]})]}),t.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:c=>{c.stopPropagation();const o=e.url||e.videoId,x=o?`${window.location.origin}/videoplayer?src=${encodeURIComponent(o)}&title=${encodeURIComponent(n||"")}`:window.location.href,S={title:n,text:n,url:x};if(navigator.share)navigator.share(S).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(x),alert(g("Share link copied"))}catch{}},children:t.jsx(T,{className:"w-5 h-5"})})]},e.videoId)})]})]}),t.jsx(H,{}),t.jsx("style",{children:`
        @keyframes toastSlideDown {
          from { opacity: 0; transform: translateY(-20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
      `})]})}const H=()=>{const[r,d]=f.useState(null),a=f.useRef(!1),i=[{name:"Home",icon:V},{name:"Requests",icon:O},{name:"Ideas",icon:P},{name:"More",icon:T}],m="rgb(107 114 128)",y=s=>{try{if(s==="Home"){window.location.href="/home.jsx";return}if(s==="Requests"){window.location.href="/requests.jsx";return}if(s==="Ideas"){window.location.href="/ideas.jsx";return}if(s==="More"){window.location.href="/more.jsx";return}}catch(l){console.warn("Navigation failed",l)}};return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(s=>{const l=s.name===r,L=l?{color:"var(--color-gold)"}:{color:m},p=l?"font-semibold":"font-normal";let v={};l&&(v.textShadow="0 0 8px var(--color-gold-light)");const k=s.icon;return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:v,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{d(s.name),a.current||(a.current=!0,y(s.name))},onTouchStart:()=>{d(s.name),a.current||(a.current=!0,y(s.name))},onClick:b=>{if(a.current){a.current=!1,b.preventDefault();return}d(s.name),y(s.name)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(k,{size:22,strokeWidth:1.5,style:L})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${p}`,style:L,children:g(s.name)})]})},s.name)})})})};export{K as clearLikedVideos,G as default,X as recordLike};
