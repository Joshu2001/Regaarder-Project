import{u as $,r as f,j as t,g as F}from"./index-1zKBlWSV.js";import{u as M}from"./navigation-DP5JS76j.js";import{C as O}from"./chevron-left-BnBTXEl-.js";import{L as P}from"./lightbulb-CwbgpHI3.js";import{M as T,F as V,P as _}from"./pencil-BOwiNf3h.js";import{H as X}from"./home-BrG4wkfM.js";const B=typeof window<"u"&&localStorage.getItem("regaarder_language")||"English",p=r=>F(r,B),E="likedVideos",R=typeof window<"u"?window.__BACKEND_URL__||`${window.location.protocol}//${window.location.hostname}:4000`:"http://localhost:4000";async function K(r){try{if(!r||!r.videoId)return;const d=localStorage.getItem(E),a=d?JSON.parse(d):[],l=a.findIndex(m=>m.videoId===r.videoId);if(r.liked){const m={videoId:r.videoId,url:r.url||null,title:r.title||null,creatorName:r.creatorName||null,imageUrl:r.imageUrl||null,likedAt:r.timestamp||new Date().toISOString()};l>=0?a[l]=m:a.unshift(m)}else l>=0&&a.splice(l,1);localStorage.setItem(E,JSON.stringify(a.slice(0,500)));try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:a.length}}))}catch{}try{const m=localStorage.getItem("regaarder_token");m&&await fetch(`${R}/likes`,{method:r.liked?"POST":"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({videoId:r.videoId})})}catch(m){console.warn("Failed to sync like to backend",m)}}catch{}}function H(){try{localStorage.removeItem(E)}catch{}try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:0}}))}catch{}}function C(){try{const r=localStorage.getItem(E);return(r?JSON.parse(r):[]).sort((a,l)=>String(l.likedAt).localeCompare(String(a.likedAt)))}catch{return[]}}function q(r){return new Date(r).toLocaleString()}function ee(){const r=$();M();const[d,a]=f.useState(()=>C()),[l,m]=f.useState({}),[y,i]=f.useState(""),[n,L]=f.useState(()=>{try{return localStorage.getItem("darkMode")==="true"}catch{return!1}});f.useRef(null);const g=f.useRef({}),[v,j]=f.useState({}),I=(e,s)=>j(u=>({...u,[e]:s})),U=e=>{try{K({videoId:e,liked:!1})}catch{}a(C()),j(s=>{const u={...s};return delete u[e],u});try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:C().length}}))}catch{}};f.useEffect(()=>{const e=()=>a(C());window.addEventListener("likes:updated",e);const s=setInterval(e,5e3);return()=>{window.removeEventListener("likes:updated",e),clearInterval(s)}},[]),f.useEffect(()=>{let e=!0;const s=async()=>{try{const h=await fetch(`${R}/videos`).catch(()=>null),N=h&&h.ok?await h.json():null,w=N&&N.videos||[],b={},c={};w.forEach(o=>{if(!o)return;o.id&&(b[o.id]=o),o.videoUrl&&(b[o.videoUrl]=o),o.url&&(b[o.url]=o);const x=(o.title||"").toLowerCase().trim();x&&(c[x]=o)}),e&&m({byKey:b,byTitle:c})}catch{}};s();const u=setInterval(s,1e4);return()=>{e=!1,clearInterval(u)}},[]);const k=f.useMemo(()=>{const e=(y||"").trim().toLowerCase();return e?d.filter(s=>(s.title||"").toLowerCase().includes(e)||(s.creatorName||"").toLowerCase().includes(e)||(s.url||"").toLowerCase().includes(e)):d},[d,y]),A=e=>{const s=e.url||e.videoId,u=e.title||"";try{const h={url:s,title:u,creatorName:e.creatorName};localStorage.setItem("miniPlayerData",JSON.stringify(h))}catch{}try{const h=`/videoplayer?src=${encodeURIComponent(s||"")}&title=${encodeURIComponent(u||"")}`;window.location.href=h}catch{r("/videoplayer")}};return t.jsxs("div",{style:{minHeight:"100vh",background:n?"#0e0e0e":"#f9fafb"},children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx("div",{className:"bg-white border-b",style:{borderColor:n?"#1a1a1a":"#e5e7eb"},children:t.jsxs("div",{className:"px-4 py-4 sticky top-0 z-20 flex items-center space-x-4",children:[t.jsx(O,{className:"w-6 h-6 cursor-pointer transition hover:opacity-75",style:{color:n?"#fff":"#374151"},onClick:()=>r(-1)}),t.jsx("h1",{className:"text-xl font-semibold",style:{color:n?"#fff":"#111"},children:p("Liked Videos")})]})}),t.jsxs("div",{className:"px-4 py-4",style:{borderBottom:`1px solid ${n?"#1a1a1a":"#e5e7eb"}`},children:[d.length>0&&t.jsx("div",{className:"mb-4",children:t.jsx("button",{onClick:()=>{H(),a([])},className:"text-sm font-medium hover:opacity-80 transition duration-150",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:p("Clear All")})}),t.jsxs("div",{className:"flex gap-3 items-center",children:[t.jsx("input",{value:y,onChange:e=>i(e.target.value),placeholder:p("Search liked videos"),className:"flex-1 px-3 py-2 rounded-md",style:{background:n?"#0b0b0b":"#fff",color:n?"#fff":"#111",border:"1px solid "+(n?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.08)")}}),t.jsxs("span",{className:"text-sm",style:{color:n?"#9ca3af":"#6b7280"},children:[k.length," ",k.length===1?p("video"):p("videos")]})]})]}),d.length>0&&t.jsxs("div",{className:"mt-3 rounded-lg p-3 flex items-center gap-2 mx-4",style:{background:n?"rgba(250,204,21,0.08)":"#FEF9C3",border:"1px solid "+(n?"rgba(250,204,21,0.25)":"#FDE68A")},children:[t.jsx(P,{className:"w-4 h-4",style:{color:"#ca8a04"}}),t.jsx("div",{className:"text-xs",style:{color:n?"#fcd34d":"#92400E"},children:p("Swipe left to remove from Liked Videos")})]}),t.jsx("div",{className:"px-4 py-6",children:t.jsxs("div",{className:"mt-5 w-full space-y-4",children:[k.length===0&&t.jsx("div",{className:"text-sm",style:{color:n?"#9ca3af":"#6b7280"},children:p("No likes yet. Tap the heart in the player to add videos here.")}),k.map(e=>{const s=e.title||e.url||e.videoId,u=e.creatorName||"",h=l&&l.byKey?l.byKey:l,N=l&&l.byTitle?l.byTitle:{},w=e.videoId&&h[e.videoId]||e.url&&h[e.url]||s&&N[s.toLowerCase()],b=e.imageUrl||w&&(w.imageUrl||w.thumbnail||w.image)||"https://placehold.co/160x90/efefef/777?text=Video";return t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:c=>{const o=g.current[e.videoId];o&&o.moved||A(e)},onPointerDown:c=>{const o=c.clientX??(c.touches&&c.touches[0]?.clientX);g.current[e.videoId]={dragging:!0,startX:o,moved:!1}},onPointerMove:c=>{const o=g.current[e.videoId];if(!o||!o.dragging)return;const x=c.clientX??(c.touches&&c.touches[0]?.clientX);if(typeof x!="number")return;const S=x-o.startX;Math.abs(S)>3&&(o.moved=!0);const D=Math.min(0,S);I(e.videoId,Math.max(-240,D))},onPointerUp:c=>{if(!g.current[e.videoId])return;const x=v[e.videoId]||0;g.current[e.videoId]={dragging:!1,startX:0,moved:!1},x<=-80?(I(e.videoId,-320),setTimeout(()=>U(e.videoId),120)):I(e.videoId,0)},style:{transform:`translateX(${v[e.videoId]||0}px)`,transition:g.current[e.videoId]?.dragging?"none":"transform 220ms ease",opacity:(v[e.videoId]||0)<0?.98:1,touchAction:"pan-y"},children:[t.jsx("img",{src:b,alt:s,className:"w-40 h-24 object-cover rounded-md",onError:c=>{c.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:s}),u&&t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["@",u]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[p("Liked")," â€¢ ",q(e.likedAt)]})]}),t.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:c=>{c.stopPropagation();const o=e.url||e.videoId,x=o?`${window.location.origin}/videoplayer?src=${encodeURIComponent(o)}&title=${encodeURIComponent(s||"")}`:window.location.href,S={title:s,text:s,url:x};if(navigator.share)navigator.share(S).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(x),alert(p("Share link copied"))}catch{}},children:t.jsx(T,{className:"w-5 h-5"})})]},e.videoId)})]})})]}),t.jsx(z,{}),t.jsx("style",{children:`
        @keyframes toastSlideDown {
          from { opacity: 0; transform: translateY(-20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
      `})]})}const z=()=>{const[r,d]=f.useState(null),a=f.useRef(!1),l=[{name:"Home",icon:X},{name:"Requests",icon:V},{name:"Ideas",icon:_},{name:"More",icon:T}],m="rgb(107 114 128)",y=i=>{try{if(i==="Home"){window.location.href="/home.jsx";return}if(i==="Requests"){window.location.href="/requests.jsx";return}if(i==="Ideas"){window.location.href="/ideas";return}if(i==="More"){window.location.href="/more.jsx";return}}catch(n){console.warn("Navigation failed",n)}};return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:l.map(i=>{const n=i.name===r,L=n?{color:"var(--color-gold)"}:{color:m},g=n?"font-semibold":"font-normal";let v={};n&&(v.textShadow="0 0 8px var(--color-gold-light)");const j=i.icon;return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:v,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{d(i.name),a.current||(a.current=!0,y(i.name))},onTouchStart:()=>{d(i.name),a.current||(a.current=!0,y(i.name))},onClick:I=>{if(a.current){a.current=!1,I.preventDefault();return}d(i.name),y(i.name)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(j,{size:22,strokeWidth:1.5,style:L})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${g}`,style:L,children:p(i.name)})]})},i.name)})})})};export{H as clearLikedVideos,ee as default,K as recordLike};
