import{f as Vs,r as s,j as e,g as i,X as Be,L as Xs,c as Qe,a as Ks,C as Gs}from"./index-J--XMc-5.js";import{r as Ut}from"./index-D81NaDOi.js";import{A as Qs}from"./alert-triangle-Cf9iF486.js";import{T as nt}from"./trending-up-BKGp63oO.js";import{S as Pt}from"./search-nPl8B-fm.js";import{C as Ot}from"./check-circle-2-C-JdFDy3.js";import{C as Zs}from"./calendar-ODENJVK4.js";import{C as gt}from"./chevron-down-0UbmDaO9.js";import{S as at}from"./sparkles-COJWI7jQ.js";import{C as Ht}from"./clock-BGa7xNqB.js";import{D as zt}from"./dollar-sign-TXFu5gC0.js";import{F as xt,H as eo,P as Wt,M as to}from"./pencil-Dw1rFXCt.js";import{H as Ke}from"./heart-BJQVjmA4.js";import{M as it}from"./message-square-Dpaavdog.js";import{P as Yt,F as so}from"./pin-Crg713h0.js";import{C as oo}from"./chevron-up-BA6NdRl1.js";import{C as ro}from"./chevrons-up-BkE5EBea.js";import{B as no}from"./bookmark-DgaFaiie.js";import{L as yt}from"./lightbulb-Nrnt1nYy.js";import{H as Vt}from"./heart-off-DBWStauo.js";import{S as ao}from"./share-2-CeL5eEF6.js";import{U as io}from"./user-Y0NnfhDK.js";import{S as Xt}from"./send-BhKSJZN7.js";const Jt=Vs("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),lo=({isOpen:t,onClose:h,requestId:l,detailedRank:w,onGiveLikeFree:m,selectedLanguage:b="English"})=>{const M=s.useRef(null),v=window.innerHeight*.5,H=window.innerHeight*.95,[z,G]=s.useState(window.innerHeight*.9),[$,Y]=s.useState(10),{rank:C,nextRankNeeded:S,threatCount:J,totalInfluence:O}=w,ce=()=>{const D=220+Math.random()*40;return Math.round(D)},[_]=s.useState(ce()),[V,W]=s.useState(O);s.useEffect(()=>{W(O)},[O]);const q=$*2,[Z,F]=s.useState("wise"),[de,se]=s.useState(!1),he=()=>C===1?i("Amplify Your Reach",b):C<=5?i("Rise in Discovery",b):i("Get More Eyes",b),pe=()=>C===1&&J>0?i("Another request is gaining traction. Stay visible to stay winning.",b):C<=5?i("Climb the rankings so creators discover your request first.",b):i("More visibility, faster fulfillment",b);s.useCallback(D=>{if(D.preventDefault(),!M.current)return;const u=D.touches[0].clientY,T=M.current.clientHeight,k=I=>{const j=I.touches[0].clientY-u;let N=T-j;N=Math.min(Math.max(N,v),H),G(N)},E=()=>{window.removeEventListener("touchmove",k),window.removeEventListener("touchend",E),M.current&&M.current.clientHeight<v+50&&h()};window.addEventListener("touchmove",k,{passive:!1}),window.addEventListener("touchend",E)},[v,H,h]),s.useEffect(()=>(t?(G(window.innerHeight*.9),document.body.style.overflow="hidden",Y(10)):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),s.useEffect(()=>{if(!t)return;const D=u=>{u.key==="Escape"&&h()};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[t,h]);const xe=s.useRef(null);return s.useEffect(()=>{if(!t||!M.current)return;xe.current=document.activeElement,setTimeout(()=>{try{const u=M.current.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');u&&u.length?u[0].focus():M.current.focus()}catch{}},50);const D=u=>{if(M.current){if(u.key==="Tab"){const T=M.current.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');if(!T||T.length===0){u.preventDefault();return}const k=T[0],E=T[T.length-1];u.shiftKey&&document.activeElement===k?(u.preventDefault(),E.focus()):!u.shiftKey&&document.activeElement===E&&(u.preventDefault(),k.focus())}u.key==="Escape"&&h()}};return document.addEventListener("keydown",D),()=>{document.removeEventListener("keydown",D);try{xe.current&&xe.current.focus&&xe.current.focus()}catch{}}},[t,h]),e.jsxs("div",{className:`fixed inset-0 z-50 transition-all duration-300 flex items-center justify-center ${t?"opacity-100":"opacity-0 pointer-events-none"}`,style:{transitionProperty:"opacity",transitionTimingFunction:"cubic-bezier(.4,0,.2,1)"},"aria-hidden":!t,children:[e.jsx("div",{className:`absolute inset-0 bg-black transition-opacity duration-300 ${t?"opacity-50":"opacity-0"}`,onClick:h,"aria-label":"Close boost modal background"}),e.jsxs("div",{ref:M,tabIndex:-1,className:"relative w-full max-w-md mx-auto rounded-3xl flex flex-col z-50",style:{maxHeight:"85vh",background:"#ffffff",boxShadow:"0 20px 40px rgba(0,0,0,0.3)",border:"1px solid #e5e7eb"},"aria-label":"Boost visibility modal",children:[e.jsxs("header",{className:"relative px-8 pt-8 pb-6 border-b border-gray-50",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:he()}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:pe()})]}),e.jsxs("main",{className:"flex-grow overflow-y-auto px-8 pb-8 space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4",children:i("How Boosting Works",b)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:i("Reach More Creators",b)}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i("Your request climbs rankings, appearing first to creators actively searching.",b)})]})]})}),e.jsx("div",{className:"bg-green-50 border border-green-100 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:i("Get Fulfilled Faster",b)}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i("Higher visibility means more creators see it, and higher chance someone claims it.",b)})]})]})})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4",children:i("Choose Your Boost",b)}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,25,50].map(D=>e.jsxs("button",{onClick:()=>Y(D),className:"relative py-6 px-2 text-center rounded-xl border-2 font-bold transition-all duration-200",style:{backgroundColor:$===D?"#111827":"#fff",color:$===D?"#fff":"#6b7280",borderColor:$===D?"#111827":"#e5e7eb",boxShadow:$===D?"0 0 12px rgba(17, 24, 39, 0.15)":"none"},children:[e.jsxs("div",{className:"text-lg font-bold",children:["$",D]}),e.jsxs("div",{className:"text-xs mt-1",style:{opacity:.7},children:["+",D*2,","]})]},D))})]})]}),e.jsx("footer",{className:"px-8 pb-10 pt-6 border-t border-gray-50",style:{paddingBottom:"calc(40px + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{className:`w-full py-4 font-semibold text-base rounded-2xl transition-all ${de?"opacity-50 pointer-events-none":"hover:scale-[1.01] active:scale-[0.99]"}`,style:{backgroundColor:"#111827",color:"#ffffff"},onClick:async()=>{se(!0);try{const u=await(await fetch("/api/pay/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:Z,requestId:l,amount:$,boost:q})})).json();if(u&&u.redirectUrl){window.location.href=u.redirectUrl;return}if(u&&u.success){W(T=>T+q),se(!1),setTimeout(()=>h(),650);return}se(!1),alert(i("Payment failed. Please try again.",b))}catch(D){console.error("Payment error",D),se(!1),alert(i("Payment failed. Please try again.",b))}},children:de?i("Processing...",b):`${i("Boost for",b)} $${$}`}),e.jsx("div",{className:"flex justify-center gap-4 pt-2",children:["Wise","Stripe","PayPal"].map(D=>e.jsx("button",{onClick:()=>F(D.toLowerCase()),className:"text-xs font-medium transition-colors",style:{color:Z===D.toLowerCase()?"#111827":"#d1d5db"},children:D},D))})]})})]})]})};function co({isOpen:t,onClose:h,onUpgrade:l,onClaimFree:w,selectedLanguage:m}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600","aria-label":"Close",children:e.jsx(Be,{size:24})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-red-100 p-3 rounded-full",children:e.jsx(Xs,{size:32,className:"text-red-600"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:i("Daily Claim Limit Reached",m)}),e.jsx("p",{className:"text-gray-600 text-sm text-center mb-6",children:i("You've reached your daily limit for paid requests. This limit helps maintain quality and fair access for all creators.",m)}),e.jsx("button",{onClick:l,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg mb-3 transition-colors",children:i("Upgrade",m)}),e.jsx("button",{onClick:w,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold py-3 rounded-lg transition-colors",children:i("Claim a Free Request",m)})]})}):null}function uo({isOpen:t,onClose:h,onUpgrade:l,onViewLowerValue:w,selectedLanguage:m}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600","aria-label":"Close",children:e.jsx(Be,{size:24})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(Qs,{size:32,className:"text-yellow-600"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:i("Request Value Limit Reached",m)}),e.jsx("p",{className:"text-gray-600 text-sm text-center mb-6",children:i("Higher-value requests need a premium plan. Choose a lower-value request or upgrade your plan.",m)}),e.jsx("button",{onClick:l,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg mb-3 transition-colors",children:i("Upgrade",m)}),e.jsx("button",{onClick:w,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold py-3 rounded-lg transition-colors",children:i("View Requests Under $150",m)})]})}):null}function mo({onClose:t,onBoostRequest:h,onInviteFriends:l,nudgeRequest:w,selectedLanguage:m}){const b=w?.selectedCreator||w?.creatorId,M=w?.selectedCreatorName||w?.creatorName||"this creator";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600","aria-label":"Close",children:e.jsx(Be,{size:24})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-amber-100 p-3 rounded-full",children:e.jsx(nt,{size:32,className:"text-amber-600"})})}),b?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:[i("Waiting on",m)," ",M]}),e.jsxs("p",{className:"text-gray-600 text-sm text-center mb-6 leading-relaxed",children:[M," ",i("receives many requests and prioritizes paid or boosted ones",m),"."]}),e.jsx("p",{className:"text-gray-600 text-sm text-center mb-6 leading-relaxed",children:i("Boosting your request signals stronger interest and increases the chance they'll respond. You can also invite others to contribute to make your request more compelling.",m)})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:i("Your Request Needs a Nudge",m)}),e.jsx("p",{className:"text-gray-600 text-sm text-center mb-6 leading-relaxed",children:i("It looks like your request hasn't reached a creator yet. Free requests can get buried as new requests come in. Boosting your request increases visibility and response speed. Inviting others to contribute can also make it more attractive to creators.",m)})]}),e.jsx("button",{onClick:h,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg mb-3 transition-colors",children:b?i("Boost",m):i("Boost for Visibility",m)}),e.jsx("button",{onClick:l,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold py-3 rounded-lg transition-colors",children:i("Invite Contributors",m)})]})})}const fo={"--color-neutral-light-bg":"var(--color-neutral-light-bg)"},pt=t=>{if(!t)return"";try{const h=String(t||"");if(h.startsWith("uploaded:")){const l=h.split(":")[1]||h.slice(9);return`${window.location.protocol}//${window.location.hostname}:4000/uploads/${l}`}if(/^https?:\/\/(localhost|127\.0\.0\.1)/.test(h))try{const l=new URL(h),w=l.port?`:${l.port}`:"";return`${window.location.protocol}//${window.location.hostname}${w}${l.pathname}`}catch{return h.replace("://localhost",`://${window.location.hostname}`)}return h}catch{return t}},ho=t=>{try{if(!t)return"";const h=new Date(t);if(isNaN(h.getTime()))return"";const l=Date.now()-h.getTime(),w=Math.floor(l/1e3);if(w<60)return"Just now";const m=Math.floor(w/60);if(m<60)return`${m}m ago`;const b=Math.floor(m/60);if(b<24)return`${b}h ago`;const M=Math.floor(b/24);if(M<7)return`${M}d ago`;const v=Math.floor(M/7);return v<4?`${v}w ago`:h.toLocaleDateString()}catch{return""}},Ge={id:"user-123",name:"You",avatarUrl:"https://placehold.co/40x40/4F46E5/ffffff?text=U"},qt=[{id:3,company:"NASA Official",timeAgo:"2w ago",title:"Artemis Program: Orion Capsule Deep Dive",description:"Requesting an educational video series on the Orion capsule, covering its design, mission parameters, and future role in lunar exploration. The content must be vetted for scientific accuracy by NASA representatives and target a middle-school to high-school educational demographic.",likes:350,comments:102,boosts:88,funding:8900,isTrending:!1,isSponsored:!1,companyInitial:"N",companyColor:"bg-blue-800",imageUrl:"uploaded:1000002754.jpg-f38ae5ef-59ef-4f7d-9c73-a5a04433228a"},{id:4,company:"Global Watchdog",timeAgo:"3d ago",title:"The Lithium Trail: Investigating Sustainable Battery Sources",description:"In-depth documentary exploring the global supply chain for lithium, tracing its journey from mining to final battery assembly. The focus should be on environmental impact, ethical sourcing challenges, and potential sustainable alternatives for the future of electric power.",likes:210,comments:78,boosts:110,funding:4500,isTrending:!0,isSponsored:!1,companyInitial:"G",companyColor:"bg-green-700",imageUrl:"uploaded:1000002752.jpg-22797b9e-93d7-4f62-a5a2-42bbe6353ed5"},{id:5,company:"Cultural Archive",timeAgo:"1w ago",title:"The Silent Screen: A History of Early Cinema",description:"Seeking a rich, detailed historical investigation into the foundational years of silent film, covering key technological innovations, the rise of the star system, and its cultural impact before the advent of sound. Requires archival footage and expert interviews.",likes:155,comments:42,boosts:55,funding:3100,isTrending:!1,isSponsored:!0,companyInitial:"C",companyColor:"bg-indigo-600",imageUrl:"uploaded:mock-image-fail-123.jpg"},{id:2,company:"Adobe Creative ...",timeAgo:"1d ago",title:"Photoshop 2025: Advanced Editing",description:"A deep dive into the new Generative Fill features and advanced mask editing workflows in the latest Photoshop release. Focus on efficiency gains and creative possibilities for professional graphic designers and digital artists.",likes:120,comments:67,boosts:67,funding:1200,isTrending:!0,isSponsored:!1,companyInitial:"A",companyColor:"bg-red-800",imageUrl:"uploaded:1000002749.jpg-948349c1-85e2-4ea6-a50c-08549e9480a6"},{id:1,company:"Tesla Motors",timeAgo:"6h ago",title:"Tesla Model Y: Full Review and Road Trip",description:"Need a comprehensive review of the Tesla Model Y including a long-distance road trip to showcase charging infrastructure and real-world range performance. The review should cover software updates, comparison with competitors, and include high-quality video footage and imagery suitable for marketing materials.",likes:89,comments:34,boosts:45,funding:2500,isTrending:!0,isSponsored:!0,companyInitial:"T",companyColor:"bg-red-600",imageUrl:"uploaded:1000002747.jpg-6e26ff74-e416-4377-b6f7-72897269edb2"}],xo=({comment:t,onReply:h,onToggleLike:l,onToggleDislike:w,onEdit:m,onDelete:b,selectedLanguage:M="English"})=>{const H=t.userId===Ge.id?Ge.avatarUrl:"https://placehold.co/40x40/CCCCCC/666666?text=G",z=t.text.split(" "),G=z[0],$=G.startsWith("@"),Y=$?G.substring(1):null,C=$?z.slice(1).join(" "):t.text,S=!!t.likedByUser,J=!!t.dislikedByUser,O=()=>{h(t)},[ce,_]=s.useState(!1),[V,W]=s.useState(t.text||"");s.useEffect(()=>{W(t.text||"")},[t.text]),s.useRef(null);const Q=()=>{const Z=typeof t.onToggleLike=="function"?t.onToggleLike:typeof l=="function"?l:null;if(Z){Z(t.id);return}typeof h=="function"&&h(t)},q=()=>{const Z=typeof t.onToggleDislike=="function"?t.onToggleDislike:typeof w=="function"?w:null;if(Z){Z(t.id);return}typeof h=="function"&&h(t)};return e.jsxs("div",{className:`flex space-x-3 py-3 border-b border-gray-50 last:border-b-0 ${$?"ml-6":""}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:H,alt:t.userName,className:"w-8 h-8 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"bg-gray-100 rounded-xl p-3 inline-block max-w-full",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800 break-words",children:t.userName}),e.jsxs("p",{className:"text-sm text-gray-700 break-words",children:[$&&e.jsxs("span",{className:"text-indigo-600 font-medium mr-1",children:["@",Y]}),C]})]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-1 ml-1 text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Just now"}),e.jsxs("button",{onClick:Q,"aria-pressed":S,className:`flex items-center space-x-1 transition-colors ${S?"text-red-500":"hover:text-gray-700"}`,"aria-label":"Like comment",children:[e.jsx(Ke,{className:"w-3.5 h-3.5",style:{fill:S?"var(--color-like)":"none",stroke:S?"var(--color-like)":"currentColor"}}),e.jsx("span",{className:"text-xs font-medium",children:t.likesCount||0})]}),e.jsxs("button",{onClick:q,"aria-pressed":J,className:`flex items-center space-x-1 transition-colors ${J?"text-red-500":"hover:text-gray-700"}`,"aria-label":"Dislike comment",children:[e.jsx(Vt,{className:"w-3.5 h-3.5",style:{stroke:J?"var(--color-like)":"currentColor",fill:"none"}}),e.jsx("span",{className:"text-xs font-medium",children:t.dislikesCount||0})]}),e.jsx("button",{onClick:O,className:"hover:text-gray-700 transition-colors",children:i("Reply",M)})]})]})]})},po=({isOpen:t,onClose:h,requestId:l,selectedLanguage:w="English"})=>{const m=s.useRef(null),b=s.useRef(null),M=s.useRef(null),v=Qe(),[H,z]=s.useState(window.innerHeight*.9),G=window.innerHeight*.4,$=window.innerHeight*.95,[Y,C]=s.useState([]),[S,J]=s.useState(""),[O,ce]=s.useState(null),_=s.useCallback(u=>{ce(u),J(`@${u.userName} `),M.current&&M.current.focus()},[]),V=s.useCallback(()=>{ce(null),J("")},[]),W=()=>{if(!v.user){v.openAuthModal();return}if(S.trim()==="")return;let u=S.trim();const T={id:`local_${Date.now()}`,userId:v.user&&v.user.id?v.user.id:Ge.id,userName:v.user&&v.user.name?v.user.name:Ge.name,text:u,timestamp:new Date,parentId:O?O.id:null,likesCount:0,dislikesCount:0,likedByUser:!1,dislikedByUser:!1};(async()=>{const k=`${window.location.protocol}//${window.location.hostname}:4000`,E=localStorage.getItem("regaarder_token");try{const I=await fetch(`${k}/requests/${l}/comments`,{method:"POST",headers:{"Content-Type":"application/json",...E?{Authorization:`Bearer ${E}`}:{}},body:JSON.stringify({text:u,parentId:O?O.id:null})});if(I.ok){const j=await I.json();if(j&&j.comment){C(N=>{const be=[...N,j.comment];try{console.debug("CommentsModal: dispatching comment_added",{requestId:l,comment:j.comment}),window.dispatchEvent(new CustomEvent("request:comment_added",{detail:{requestId:l,comment:j.comment}}))}catch(ge){console.warn(ge)}return be});return}}}catch(I){console.warn("CommentsModal: POST comment failed",I)}C(I=>{const j=[...I,T];try{console.debug("CommentsModal: dispatching comment_added (local)",{requestId:l,comment:T}),window.dispatchEvent(new CustomEvent("request:comment_added",{detail:{requestId:l,comment:T}}))}catch(N){console.warn(N)}return j})})(),J(""),ce(null)},Q=(u,T)=>{(async()=>{const k=`${window.location.protocol}//${window.location.hostname}:4000`,E=localStorage.getItem("regaarder_token");try{const I=await fetch(`${k}/requests/${l}/comments/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",...E?{Authorization:`Bearer ${E}`}:{}},body:JSON.stringify({text:T})});if(I.ok){const j=await I.json();C(N=>{const be=N.map(ge=>ge.id===u?j.comment||{...ge,text:T}:ge);try{console.debug("CommentsModal: dispatching comment_updated",{requestId:l,commentId:u,newText:T}),window.dispatchEvent(new CustomEvent("request:comment_updated",{detail:{requestId:l,commentId:u,newText:T}}))}catch(ge){console.warn(ge)}return be});return}}catch(I){console.warn("CommentsModal: PUT comment failed",I)}C(I=>{const j=I.map(N=>N.id===u?{...N,text:T}:N);try{console.debug("CommentsModal: dispatching comment_updated (local)",{requestId:l,commentId:u,newText:T}),window.dispatchEvent(new CustomEvent("request:comment_updated",{detail:{requestId:l,commentId:u,newText:T}}))}catch(N){console.warn(N)}return j})})()},q=u=>{(async()=>{const T=`${window.location.protocol}//${window.location.hostname}:4000`,k=localStorage.getItem("regaarder_token");try{if((await fetch(`${T}/requests/${l}/comments/${u}`,{method:"DELETE",headers:{...k?{Authorization:`Bearer ${k}`}:{}}})).ok){C(I=>{const j=I.filter(N=>N.id!==u);try{console.debug("CommentsModal: dispatching comment_deleted",{requestId:l,commentId:u}),window.dispatchEvent(new CustomEvent("request:comment_deleted",{detail:{requestId:l,commentId:u}}))}catch(N){console.warn(N)}return j});return}}catch(E){console.warn("CommentsModal: DELETE comment failed",E)}C(E=>{const I=E.filter(j=>j.id!==u);try{console.debug("CommentsModal: dispatching comment_deleted (local)",{requestId:l,commentId:u}),window.dispatchEvent(new CustomEvent("request:comment_deleted",{detail:{requestId:l,commentId:u}}))}catch(j){console.warn(j)}return I})})()},Z=async(u,T)=>{try{const k=localStorage.getItem("regaarder_token");if(!k)return;const E=window&&window.__BACKEND_URL__||"http://localhost:4000";await fetch(`${E}/comments/react`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({commentId:u,action:T,requestId:l})})}catch(k){console.warn("Failed to react to comment",k)}},F=u=>{if(!v.user){v.openAuthModal();return}C(T=>T.map(k=>{if(k.id!==u)return k;const E=!!k.likedByUser,I=!!k.dislikedByUser;let j=Number(k.likesCount||0),N=Number(k.dislikesCount||0);return E?(j=Math.max(0,j-1),Z(u,"unlike"),{...k,likedByUser:!1,likesCount:j}):(j=j+1,Z(u,"like"),I?(N=Math.max(0,N-1),{...k,likedByUser:!0,dislikedByUser:!1,likesCount:j,dislikesCount:N}):{...k,likedByUser:!0,likesCount:j})}))},de=u=>{if(!v.user){v.openAuthModal();return}C(T=>T.map(k=>{if(k.id!==u)return k;const E=!!k.likedByUser,I=!!k.dislikedByUser;let j=Number(k.likesCount||0),N=Number(k.dislikesCount||0);return I?(N=Math.max(0,N-1),Z(u,"undislike"),{...k,dislikedByUser:!1,dislikesCount:N}):(N=N+1,Z(u,"dislike"),E?(j=Math.max(0,j-1),{...k,dislikedByUser:!0,likedByUser:!1,likesCount:j,dislikesCount:N}):{...k,dislikedByUser:!0,dislikesCount:N})}))};s.useEffect(()=>{b.current&&setTimeout(()=>{b.current.scrollTop=b.current.scrollHeight},0)},[Y]);const se=s.useCallback(u=>{if(u.preventDefault(),!m.current)return;const T=u.touches[0].clientY,k=m.current.clientHeight,E=j=>{const N=j.touches[0].clientY-T;let be=k-N;be=Math.min(Math.max(be,G),$),z(be)},I=()=>{window.removeEventListener("touchmove",E),window.removeEventListener("touchend",I),m.current&&m.current.clientHeight<G+50&&h()};window.addEventListener("touchmove",E,{passive:!1}),window.addEventListener("touchend",I)},[G,$,h]),he=u=>`comments_request_${u}`;s.useEffect(()=>(t?(z(window.innerHeight*.9),document.body.style.overflow="hidden",(async()=>{try{if(l){const u=`${window.location.protocol}//${window.location.hostname}:4000`,T=await fetch(`${u}/requests/${l}/comments`);if(T.ok){const E=await T.json();if(E&&Array.isArray(E.comments)){C(E.comments);return}}const k=localStorage.getItem(he(l));if(k){const E=JSON.parse(k);C(Array.isArray(E)?E:[])}else C([])}else C([])}catch{try{const T=localStorage.getItem(he(l));if(T){const k=JSON.parse(T);C(Array.isArray(k)?k:[])}else C([])}catch{C([])}}})(),ce(null),J(""),setTimeout(()=>{M.current&&M.current.focus()},300)):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,l]),s.useEffect(()=>{try{l&&localStorage.setItem(he(l),JSON.stringify(Y))}catch{}},[Y,l]);const pe=S.trim().length>0,xe=pe?{backgroundColor:"#4b5563",color:"white"}:{backgroundColor:"#e5e7eb",color:"#9ca3af"},D=Y.length;return e.jsxs("div",{className:`fixed inset-0 z-50 transition-all duration-300 ${t?"translate-y-0":"translate-y-full pointer-events-none"}`,style:{transitionProperty:"transform",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:t?"300ms":"0ms"},children:[e.jsx("div",{className:`absolute inset-0 bg-black transition-opacity duration-300 ${t?"opacity-50":"opacity-0"}`,onClick:h}),e.jsxs("div",{ref:m,className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl flex flex-col shadow-2xl transition-transform duration-300 ease-in-out",style:{height:t?H:0},children:[e.jsx("div",{className:"flex justify-center py-2 flex-shrink-0",onTouchStart:se,children:e.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full cursor-grab"})}),e.jsx("header",{className:"flex items-center px-4 py-3 border-b border-gray-100 flex-shrink-0",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(it,{className:"w-5 h-5 mr-2 text-gray-500"})," ",i("Comments",w)]})}),e.jsx("main",{ref:b,className:"flex-grow overflow-y-auto px-4",children:D===0?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[200px]",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx(it,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-700 font-semibold mb-2",children:i("No comments yet",w)}),e.jsx("p",{className:"text-sm text-gray-500",children:i("Be the first to share your thoughts!",w)})]})}):e.jsx("div",{className:"space-y-1 pt-2 pb-4",children:Y.map(u=>e.jsx(xo,{comment:u,onReply:_,onToggleLike:F,onToggleDislike:de,onEdit:Q,onDelete:q,selectedLanguage:w},u.id))})}),e.jsxs("footer",{className:"p-4 border-t border-gray-100 flex-shrink-0",children:[O&&e.jsxs("div",{className:"flex items-center justify-between p-2 mb-2 bg-gray-100 rounded-lg text-sm text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:[i("Replying to",w)," ",e.jsx("span",{className:"text-indigo-600 font-semibold",children:O.userName})]}),e.jsx("button",{onClick:V,className:"p-1 rounded-full hover:bg-gray-200 transition-colors","aria-label":"Cancel reply",children:e.jsx(Be,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{ref:M,type:"text",placeholder:i("Add a comment... (use @ to mention)",w),value:S,onChange:u=>J(u.target.value),onKeyPress:u=>{u.key==="Enter"&&pe&&W()},className:"w-full py-3 px-4 bg-gray-100 border border-gray-200 rounded-xl focus:outline-none focus:ring-1 focus:ring-gray-300 focus:border-gray-300 text-gray-700 placeholder-gray-500"}),e.jsx("button",{onClick:W,disabled:!pe,style:xe,className:`p-2 rounded-full transition-colors flex-shrink-0 ${pe?"hover:bg-gray-700":"cursor-not-allowed"}`,children:e.jsx(Xt,{className:"w-5 h-5"})})]})]})]})]})},go=({isOpen:t,onClose:h,requestId:l,selectedLanguage:w="English"})=>{const m=s.useRef(null),b=s.useRef(null),M=s.useRef(null),[v,H]=s.useState(window.innerHeight*.9),z=window.innerHeight*.4,G=window.innerHeight*.95,$=Qe(),[Y,C]=s.useState(""),[S,J]=s.useState([]),[O,ce]=s.useState(!1),_="var(--color-gold)",V="var(--color-gold-light)";s.useEffect(()=>{try{localStorage.getItem("has_seen_suggestions_modal")||(ce(!0),localStorage.setItem("has_seen_suggestions_modal","1"))}catch{}},[]);const W=async()=>{if(!$.user)return;const F=Y.trim();if(!F)return;const de={id:Date.now(),text:F,userName:$.user&&($.user.name||$.user.email)||Ge.name,timestamp:new Date};J(se=>[...se,de]),C("");try{const se=localStorage.getItem("regaarder_token");se&&await fetch(`${window.location.protocol}//${window.location.hostname}:4000/suggestion`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se}`},body:JSON.stringify({requestId:l,text:F})})}catch{}M.current&&setTimeout(()=>M.current.focus(),50)};s.useEffect(()=>{b.current&&setTimeout(()=>{b.current.scrollTop=b.current.scrollHeight},0)},[S]);const Q=s.useCallback(F=>{if(F.preventDefault(),!m.current)return;const de=F.touches[0].clientY,se=m.current.clientHeight,he=xe=>{const D=xe.touches[0].clientY-de;let u=se-D;u=Math.min(Math.max(u,z),G),H(u)},pe=()=>{window.removeEventListener("touchmove",he),window.removeEventListener("touchend",pe),m.current&&m.current.clientHeight<z+50&&h()};window.addEventListener("touchmove",he,{passive:!1}),window.addEventListener("touchend",pe)},[z,G,h]);s.useEffect(()=>(t?(H(window.innerHeight*.9),document.body.style.overflow="hidden",C(""),(async()=>{try{if(l){const F=`${window.location.protocol}//${window.location.hostname}:4000`,de=await fetch(`${F}/requests/${l}/suggestions`);if(de.ok){const se=await de.json();if(se&&Array.isArray(se.suggestions)){J(se.suggestions);return}}}}catch{}J([])})(),setTimeout(()=>{M.current&&M.current.focus()},300)):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,l]);const q=Y.trim().length>0,Z=S.length;return e.jsxs("div",{className:`fixed inset-0 z-50 transition-all duration-300 ${t?"translate-y-0":"translate-y-full pointer-events-none"}`,style:{transitionProperty:"transform",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:t?"300ms":"0ms"},children:[e.jsx("div",{className:`absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity duration-300 ${t?"opacity-100":"opacity-0"}`,onClick:h}),e.jsxs("div",{ref:m,className:"absolute bottom-0 left-0 right-0 rounded-t-3xl flex flex-col shadow-2xl transition-transform duration-300 ease-in-out",style:{height:t?v:0,background:"linear-gradient(180deg, #ffffff 0%, #fefdfb 100%)",boxShadow:"0 -8px 32px rgba(0,0,0,0.12), 0 -2px 8px rgba(203,138,0,0.08)",border:"1px solid rgba(203,138,0,0.1)",borderBottom:"none"},children:[e.jsx("div",{className:"flex justify-center py-2 flex-shrink-0",onTouchStart:Q,children:e.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full cursor-grab"})}),e.jsx("header",{className:"px-5 pt-2 pb-4 flex-shrink-0",children:e.jsx("div",{className:"flex items-start mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center",style:{background:`linear-gradient(135deg, ${V} 0%, rgba(255,255,255,0.3) 100%)`,boxShadow:"0 2px 8px rgba(203,138,0,0.15)"},children:e.jsx(yt,{className:"w-6 h-6",style:{color:_}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 flex items-center",children:i("Creative Suggestions",w)}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:i("on Request #req_1767338342444",w).replace("#req_1767338342444",`#${l}`)})]})]})})}),e.jsxs("main",{ref:b,className:"flex-grow overflow-y-auto px-5",children:[O&&e.jsxs("div",{className:"relative p-4 mb-5 rounded-2xl overflow-hidden",style:{background:`linear-gradient(135deg, ${V} 0%, rgba(255,250,240,0.4) 100%)`,border:`1.5px solid ${_}`,boxShadow:"0 4px 12px rgba(203,138,0,0.12)"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 opacity-10",style:{background:`radial-gradient(circle, ${_} 0%, transparent 70%)`}}),e.jsxs("div",{className:"relative flex items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 mr-3",style:{background:`linear-gradient(135deg, ${V} 0%, rgba(255,255,255,0.3) 100%)`,boxShadow:"0 2px 6px rgba(0,0,0,0.08)"},children:e.jsx(at,{className:"w-5 h-5",style:{color:_}})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-sm mb-1 flex items-center",style:{color:_},children:[e.jsx(at,{className:"w-4 h-4 mr-1.5",style:{color:_}}),i("Reward Great Ideas",w)]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:i("Creators love your input! Show appreciation by tipping contributors for their valuable creative suggestions that help shape amazing content.",w)})]})]})]}),Z===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center min-h-[200px]",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mb-4",style:{background:`linear-gradient(135deg, ${V} 0%, rgba(255,255,255,0.3) 100%)`,boxShadow:"0 4px 12px rgba(203,138,0,0.1)"},children:e.jsx(yt,{className:"w-10 h-10",style:{color:_,opacity:.7}})}),e.jsx("p",{className:"text-lg font-bold text-gray-800 mb-2",children:i("No suggestions yet",w)}),e.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:i("Be the first to share a creative idea and help shape this content!",w)})]}):e.jsx("div",{className:"space-y-3 pb-4",children:S.map((F,de)=>e.jsxs("div",{className:"p-4 rounded-xl border transition-all hover:shadow-md",style:{background:"linear-gradient(135deg, #ffffff 0%, #fafafa 100%)",borderColor:"#e5e7eb",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold text-white",style:{background:`linear-gradient(135deg, ${_}, ${V})`},children:F.userName.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:F.userName}),e.jsx("p",{className:"text-[10px] text-gray-400",children:i("Just now",w)})]})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed pl-9",children:F.text})]},de))})]}),e.jsx("footer",{className:"p-5 border-t flex-shrink-0",style:{borderColor:"rgba(203,138,0,0.1)",background:"linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(254,253,251,0.98) 100%)",backdropFilter:"blur(8px)"},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{ref:M,type:"text",placeholder:i("What would make this video amazing?",w),value:Y,onChange:F=>C(F.target.value),onKeyPress:F=>{F.key==="Enter"&&q&&W()},className:"flex-1 py-3 px-5 bg-white border-2 rounded-2xl focus:outline-none text-gray-800 placeholder-gray-400 transition-all",style:{borderColor:q?_:"#e5e7eb",boxShadow:q?`0 0 0 3px ${V}`:"none"}}),e.jsx("button",{onClick:W,disabled:!q,className:`w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0 transition-all shadow-md ${q?"hover:scale-105 active:scale-95":"cursor-not-allowed opacity-50"}`,style:{background:q?`linear-gradient(135deg, ${_}, ${V})`:"#e5e7eb",boxShadow:q?"0 4px 12px rgba(203,138,0,0.3)":"none"},children:e.jsx(Xt,{className:"w-5 h-5 text-white"})})]})})]})]})},yo=({isOpen:t,onClose:h,onConfirm:l,selectedLanguage:w="English"})=>t?e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 px-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:h}),e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm relative z-10 overflow-hidden animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:i("Ready to Commit?",w)}),e.jsx("p",{className:"text-sm text-gray-600 mb-8 leading-relaxed",children:i("Claiming this request means you take responsibility for creating the video and must submit a first update within 48 hours.",w)}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors",children:i("Not Yet",w)}),e.jsx("button",{onClick:l,className:"flex-1 py-3 px-4 text-white font-bold rounded-xl transition-colors shadow-lg",style:{backgroundColor:"var(--color-gold)",boxShadow:"0 4px 12px -2px rgba(var(--color-gold-rgb), 0.35)"},children:i("Claim",w)})]})]})})]}):null,Xe=({message:t,isVisible:h,onClose:l,actionLabel:w,onAction:m,variant:b="success",selectedLanguage:M="English"})=>{const[v,H]=s.useState(0),[z,G]=s.useState(!1),$=s.useRef(0),Y=s.useRef(null);s.useEffect(()=>{if(h){const Q=setTimeout(()=>{C()},4e3);return()=>clearTimeout(Q)}},[h,l]);const C=()=>{G(!0),setTimeout(()=>{l()},300)},S=Q=>{$.current=Q.touches[0].clientX},J=Q=>{const Z=Q.touches[0].clientX-$.current;H(Z)},O=()=>{Math.abs(v)>80?C():H(0)},ce=Q=>{$.current=Q.clientX,Y.current&&(Y.current.style.cursor="grabbing")},_=Q=>{if($.current===0)return;const q=Q.clientX-$.current;H(q)},V=()=>{Math.abs(v)>80?C():H(0),$.current=0,Y.current&&(Y.current.style.cursor="grab")},W=b==="success"?"bg-green-500":"bg-gray-400";return e.jsx("div",{className:`fixed top-6 left-4 right-4 z-[70] flex justify-center transition-all duration-500 ease-out ${h&&!z?"translate-y-0 opacity-100":"-translate-y-8 opacity-0 pointer-events-none"}`,children:e.jsxs("div",{ref:Y,className:"bg-white text-gray-900 px-4 py-3 rounded-lg shadow-lg flex items-start max-w-md border border-gray-100 w-full cursor-grab select-none transition-all duration-300",style:{transform:`translateX(${v}px)`,animation:h&&!z?"toastSlideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1)":"none"},onTouchStart:S,onTouchMove:J,onTouchEnd:O,onMouseDown:ce,onMouseMove:_,onMouseUp:V,onMouseLeave:V,children:[e.jsx("style",{children:`
                    @keyframes toastSlideDown {
                        from {
                            opacity: 0;
                            transform: translateY(-20px) scale(0.95);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }
                `}),e.jsx("div",{className:`${W} rounded-full p-1 flex-shrink-0 mt-0.5 mr-3`,children:b==="success"?e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("circle",{cx:"12",cy:"12",r:"6"})})}),e.jsxs("div",{className:"flex-grow mr-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:b==="success"?i("Success",M):i("Notice",M)}),e.jsx("p",{className:"text-sm text-gray-600 leading-snug mt-0.5",children:t})]}),w&&m&&e.jsx("button",{onClick:()=>{m(),l()},className:"mr-3 text-sm font-semibold text-gray-700 hover:underline","aria-label":w,children:w})]})})},bo=({request:t,detailedRank:h,searchQuery:l,isPinned:w=!1,onTogglePin:m,pulseActive:b=!1,onOpenProfile:M,selectedLanguage:v="English",initialBookmarked:H=!1,onBookmarkChange:z=null})=>{const G="var(--color-gold)",$=fo["--color-neutral-light-bg"],[Y,C]=s.useState(!1),[S,J]=s.useState(!1),[O,ce]=s.useState(!1),[_,V]=s.useState(!1);s.useEffect(()=>{try{J(!!H)}catch{}},[H]);const[W,Q]=s.useState(0),[q,Z]=s.useState(!1),F=s.useRef(0),de=s.useRef(0),se=s.useRef(null),[he,pe]=s.useState(!1),[xe,D]=s.useState(!0),[u,T]=s.useState(null),[k,E]=s.useState({visible:!1,message:""}),[I,j]=s.useState(!1),[N,be]=s.useState(!1),[ge,Re]=s.useState(!1),[He,_e]=s.useState(!1),[ye,Fe]=s.useState({left:0,top:0}),[Ce,we]=s.useState(!1),Ne=s.useRef(null),ze=s.useRef(null),[Ze,lt]=s.useState({}),Te=s.useRef(null),Ee=s.useRef(!1),[Le,Ye]=s.useState(!1),[et,Me]=s.useState(!1),[Je,$e]=s.useState(!1),ue=s.useRef(null),[Ie,tt]=s.useState(!1),o=s.useRef(null),[n,d]=s.useState("spam"),[c,r]=s.useState(""),[y,f]=s.useState({visible:!1,message:""}),[B,R]=s.useState(!1),[re,K]=s.useState(!1),[ae,ne]=s.useState(!1),[ee,p]=s.useState(t.likes),[oe,U]=s.useState(!1),[le,me]=s.useState(!1),A=Qe(),[L,Se]=s.useState(!!t.claimed),[je,qe]=s.useState(t.claimedBy||null),[ct,Ae]=s.useState(!1),[st,bt]=s.useState(!1),[wt,De]=s.useState({visible:!1,message:""}),[Kt,ot]=s.useState(!1),[vt,jt]=s.useState(t.title||""),[kt,Nt]=s.useState(t.description||"");s.useEffect(()=>{Se(!!t.claimed),qe(t.claimedBy||null);try{jt(t.title||"")}catch{}try{Nt(t.description||"")}catch{}},[t.claimed,t.claimedBy,t.title,t.description]);const[St,dt]=s.useState(!1),[Gt,Ct]=s.useState(h.totalInfluence);s.useEffect(()=>{Ct(h.totalInfluence)},[h.totalInfluence]),s.useEffect(()=>{try{const a=localStorage.getItem("request_reacts_v1");if(a){const g=(JSON.parse(a)||{})[t.id];g&&(typeof g.likesCount=="number"&&p(g.likesCount),typeof g.isLiked=="boolean"&&j(g.isLiked),typeof g.isDisliked=="boolean"&&Ye(g.isDisliked))}}catch{}},[t.id]),s.useEffect(()=>{t.imageUrl&&t.imageUrl.includes("mock-image-fail")&&dt(!0)},[t.imageUrl]);const Qt=()=>{dt(!0)},ut=s.useRef(0),Zt=300,Tt=120,mt=t&&typeof t.description=="string"?t.description:"",Et=mt.length>Tt,es=Y||!Et?mt:mt.substring(0,Tt)+"...",ts=()=>{C(!Y)},ss=()=>{const a=A.user&&A.user.token||localStorage.getItem("regaarder_token"),x=S,g=!x;J(g),console.log("Toggling bookmark:",{requestId:t.id,action:g?"add":"remove",title:t.title,hasToken:!!a});const P=`${window.location.protocol}//${window.location.hostname}:4000`;(async()=>{const te={"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}};if(g){const ie=await fetch(`${P}/bookmarks/requests`,{method:"POST",headers:te,body:JSON.stringify({requestId:t.id,title:t.title||""})}),fe=await ie.json();if(console.log("Bookmark add response:",fe),!ie.ok||!fe.success)throw new Error("Bookmark add failed");return!0}else{const ie=await fetch(`${P}/bookmarks/requests`,{method:"DELETE",headers:te,body:JSON.stringify({requestId:t.id})}),fe=await ie.json();if(console.log("Bookmark remove response:",fe),!ie.ok||!fe.success)throw new Error("Bookmark remove failed");return!0}})().then(()=>{g&&f({visible:!0,message:"Saved to bookmarks"});try{z&&z(t.id,g)}catch{}}).catch(te=>{console.error("Bookmark error:",te),J(x),De({visible:!0,message:"Bookmark failed"})})},os=()=>{u&&(u.type==="bookmark"&&J(u.prev),u.type==="dismiss"&&(se.current&&(clearTimeout(se.current),se.current=null),pe(!1),D(!0)),T(null),E({visible:!1,message:""}))},At=(a,x)=>{F.current=a,de.current=x,Z(!1),Q(0)},Rt=(a,x,g)=>{const P=a-F.current,X=x-de.current;if(q){try{g&&g.preventDefault&&g.preventDefault()}catch{}Q(P)}else{const te=Math.abs(P),ie=Math.abs(X);if(te>12&&te>ie*1.3){Z(!0);try{g&&g.preventDefault&&g.preventDefault()}catch{}Q(P)}else return}},Mt=()=>{if(!q){Q(0);return}Z(!1),W<-110?(T({type:"dismiss",prevVisible:xe}),pe(!0),se.current=setTimeout(()=>{D(!1),pe(!1)},420),Q(0),E({visible:!0,message:"Hidden from feed"})):Q(0)},rs=a=>{!a.touches||a.touches.length===0||At(a.touches[0].clientX,a.touches[0].clientY)},ns=a=>{!a.touches||a.touches.length===0||Rt(a.touches[0].clientX,a.touches[0].clientY,a)},as=a=>{Mt()},is=a=>{At(a.clientX,a.clientY),window.addEventListener("mousemove",$t),window.addEventListener("mouseup",It)},$t=a=>{Rt(a.clientX,a.clientY,a)},It=a=>{window.removeEventListener("mousemove",$t),window.removeEventListener("mouseup",It),Mt()},ft=()=>{if(!A.user){A.openAuthModal();return}const a="request_reacts_v1";j(x=>{const g=!x;if(p(P=>{const X=g?P+1:Math.max(0,P-1);g&&Le&&Ye(!1);try{const te=localStorage.getItem(a),ie=te?JSON.parse(te):{};ie[t.id]=ie[t.id]||{},ie[t.id].likesCount=X,ie[t.id].isLiked=g,ie[t.id].isDisliked=g&&Le?!1:ie[t.id].isDisliked||!1,localStorage.setItem(a,JSON.stringify(ie))}catch{}return X}),Ct(P=>g?P+1:Math.max(0,P-1)),g)try{if(!localStorage.getItem("heart_longpress_hint_shown"))try{const X=Ne.current,te=8;if(X&&X.getBoundingClientRect){const ie=X.getBoundingClientRect(),fe=ie.left+ie.width/2,We=ie.top-te;Fe({left:fe,top:We}),_e(!0),setTimeout(()=>{try{const Ue=document.querySelector(".hint-bubble");if(Ue&&Ue.offsetWidth){const Pe=Ue.offsetWidth,ke=Pe/2,Ve=ke+62,ve=window.innerWidth-ke-8;let Oe=fe;Oe<Ve&&(Oe=Ve),Oe>ve&&(Oe=ve);const zs=Math.max(8,We);let Ys=fe-Oe+ke-18;const Js=12,qs=Math.max(12,Pe-12),Ws=Math.max(Js,Math.min(qs,Ys));Fe({left:Oe,top:zs,tailLeft:Ws,tailClass:"hint-tail-left-edge"})}}catch{}},20),(function(){let Pe=null;const ke=()=>{try{Pe&&clearTimeout(Pe)}catch{}try{document.removeEventListener("pointerdown",ke,!0)}catch{}try{document.removeEventListener("touchstart",ke,!0)}catch{}try{window.removeEventListener("keydown",Ve,!0)}catch{}try{localStorage.setItem("heart_longpress_hint_shown","1")}catch{}_e(!1)},Ve=ve=>{ve.key==="Escape"&&ke()};try{document.addEventListener("pointerdown",ke,{once:!0,capture:!0}),document.addEventListener("touchstart",ke,{once:!0,capture:!0}),window.addEventListener("keydown",Ve,{capture:!0})}catch{}try{Pe=setTimeout(ke,15e3)}catch{}})()}else{const ie=Math.max(48,window.innerWidth/2);Fe({left:ie,top:48}),_e(!0),setTimeout(()=>_e(!1),3800)}}catch{}}catch{}return g});try{const x=A.user&&A.user.token||localStorage.getItem("regaarder_token"),g=I?"unlike":"like";fetch(`${window.location.protocol}//${window.location.hostname}:4000/requests/react`,{method:"POST",headers:{"Content-Type":"application/json",...x?{Authorization:`Bearer ${x}`}:{}},body:JSON.stringify({requestId:t.id,action:g})}).catch(()=>{})}catch{}},ls=()=>{if(!A.user)return A.openAuthModal();U(!0)},cs=()=>{U(!1)},ds=()=>{if(!A.user){A.openAuthModal();return}me(!0)},us=()=>{me(!1)},ms=()=>{if(!A.user){A.openAuthModal();return}R(!0)},fs=()=>{R(!1)},hs=()=>{if(!L){if(!A.user){A.openAuthModal();return}if(t.creator&&t.creator.id&&A.user&&A.user.id&&t.creator.id===A.user.id){De({visible:!0,message:"You cannot claim your own request"});return}Ae(!0)}},xs=async()=>{const a=A.user&&A.user.token||localStorage.getItem("regaarder_token");if(!a){A.openAuthModal();return}try{const x=await fetch(`${window.location.protocol}//${window.location.hostname}:4000/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({requestId:t.id})});if(!x.ok){const fe=await x.json().catch(()=>({error:"Claim failed"}));if(fe.requestValueLimitExceeded){Ae(!1),ne(!0);return}if(x.status===429&&fe.dailyClaimLimitReached){Ae(!1),K(!0);return}throw new Error(fe.error||"Claim failed")}const g=await x.json();Se(!0),qe(g.claimedBy),Ae(!1),bt(!0);const P={requestId:t.id,id:t.id,title:t.title||"Untitled Request",requesterName:t.company||t.creator&&t.creator.name||"Anonymous",requesterAvatar:pt(t.creator&&(t.creator.image||t.creator.avatar)?t.creator.image||t.creator.avatar:null)||null,funding:t.funding||0,description:t.description||"",currentStep:1,claimedBy:g.claimedBy,claimedAt:g.claimedAt||new Date().toISOString()},X=localStorage.getItem("claimedRequests");let te=[];try{te=X?JSON.parse(X):[],Array.isArray(te)||(te=[])}catch{te=[]}if(!te.some(fe=>fe.id===P.id))te.push(P),localStorage.setItem("claimedRequests",JSON.stringify(te));else{const fe=te.findIndex(We=>We.id===P.id);fe!==-1&&(te[fe]=P),localStorage.setItem("claimedRequests",JSON.stringify(te))}window.dispatchEvent(new CustomEvent("request:claimed",{detail:P}))}catch(x){if(console.error("Claim error:",x),x&&x.message&&x.message.toLowerCase().includes("unauthor")){A.openAuthModal();return}De({visible:!0,message:x.message||"Claim failed"}),Ae(!1)}},ps=a=>{if(!(oe||le||B)&&a.type==="touchend"){const x=new Date().getTime(),g=ut.current;x-g<Zt?(I||(ft(),o.current&&clearTimeout(o.current),tt(!0),o.current=setTimeout(()=>tt(!1),900)),ut.current=0):ut.current=x}},gs=()=>{if(!A.user){A.openAuthModal();return}const a="request_reacts_v1";Ye(x=>{const g=!x;g?(j(!1),p(P=>Math.max(0,P-1)),E({visible:!0,message:"Marked as disliked"})):E({visible:!0,message:"Removed dislike"});try{const P=localStorage.getItem(a),X=P?JSON.parse(P):{};X[t.id]=X[t.id]||{},X[t.id].isDisliked=g,X[t.id].likesCount=X[t.id].likesCount||ee,X[t.id].isLiked=g?!1:X[t.id].isLiked||!1,localStorage.setItem(a,JSON.stringify(X))}catch{}return g});try{const x=A.user&&A.user.token||localStorage.getItem("regaarder_token"),g=Le?"undislike":"dislike";fetch(`${window.location.protocol}//${window.location.hostname}:4000/requests/react`,{method:"POST",headers:{"Content-Type":"application/json",...x?{Authorization:`Bearer ${x}`}:{}},body:JSON.stringify({requestId:t.id,action:g})}).catch(()=>{})}catch{}ue.current&&clearTimeout(ue.current),ue.current=setTimeout(()=>we(!1),1400)},ys=()=>{Me(!0)},bs=()=>{$e(!0)},ws=()=>{if(w)rt(!0);else{try{typeof m=="function"&&m()}catch{}we(!1)}},[vs,rt]=s.useState(!1),js=()=>{if(w)rt(!0);else try{typeof m=="function"&&m()}catch{}},ks=()=>{try{typeof m=="function"&&m()}catch{}rt(!1),we(!1)},Dt=()=>{rt(!1)},Ns=()=>{Me(!1),we(!1),E({visible:!0,message:`Reported  ${n==="other"?c||"Other":n}`})},Ss=async a=>{try{if(navigator&&navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(a),!0}catch(x){console.error("navigator.clipboard.writeText failed",x)}try{const x=document.createElement("textarea");x.value=a,x.style.position="fixed",x.style.left="-9999px",x.style.top="0",document.body.appendChild(x),x.focus(),x.select();const g=document.execCommand("copy");return document.body.removeChild(x),!!g}catch(x){return console.error("fallback copy failed",x),!1}},Bt=async()=>{const a=`https://regaarder.com/request/${t.id}`,x=`${t.title}
${a}`,g=await Ss(x);E(g?{visible:!0,message:"Link copied to clipboard"}:{visible:!0,message:"Copy failed"}),$e(!1),we(!1)},Cs=async()=>{const a=`https://regaarder.com/request/${t.id}`;try{if(navigator&&navigator.share){await navigator.share({title:t.title,text:`${t.title}
${a}`,url:a}),E({visible:!0,message:"Shared"}),$e(!1),we(!1);return}}catch(x){console.error("navigator.share failed",x)}await Bt()},_t=a=>{Ee.current=!1,Te.current&&clearTimeout(Te.current),a.touches?a.touches[0].clientX:a.clientX,a.touches?a.touches[0].clientY:a.clientY,Te.current=setTimeout(()=>{Ee.current=!0;try{if(Ne.current){const x=Ne.current.getBoundingClientRect(),g=x.left+x.width/2,P=x.top-8;lt({position:"fixed",left:`${g}px`,top:`${P}px`,transform:"translate(-50%, -100%)"})}}catch{}we(!0)},520)},ht=()=>{Te.current&&(clearTimeout(Te.current),Te.current=null)};if(s.useEffect(()=>{if(!Ce)return;const a=x=>{const g=x.target;Ne.current&&Ne.current.contains(g)||ze.current&&ze.current.contains(g)||we(!1)};return window.addEventListener("pointerdown",a),()=>window.removeEventListener("pointerdown",a)},[Ce]),s.useEffect(()=>{if(!Ce){ue.current&&(clearTimeout(ue.current),ue.current=null);return}return ue.current&&clearTimeout(ue.current),ue.current=setTimeout(()=>we(!1),4e3),()=>{ue.current&&(clearTimeout(ue.current),ue.current=null)}},[Ce]),!xe)return null;const Ts={position:"absolute",top:"50%",right:"-12px",transform:"translateY(-50%) rotate(-90deg)",transformOrigin:"50% 50%",backgroundColor:L?"#d1d5db":$,color:"#6b7280",fontSize:"11px",fontWeight:"bold",padding:"5px 12px",borderRadius:"6px",letterSpacing:"0.5px",boxShadow:L?"0 2px 6px rgba(107, 114, 128, 0.2)":"none",border:"none",whiteSpace:"nowrap",cursor:L?"default":"pointer",height:"auto",lineHeight:"1",zIndex:10,transition:"all 0.3s ease"},Es={background:`radial-gradient(circle at 100% 0%, ${$} 0%, rgba(243, 244, 246, 0.8) 70%, transparent 100%)`,zIndex:0,pointerEvents:"none"},As={backgroundColor:G,color:"white",fontWeight:"bold",padding:"4px 10px",borderRadius:"0 10px 0 10px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",fontSize:"14px",zIndex:5},Rs={backgroundColor:$,color:G,fontWeight:"600",padding:"3px 8px 3px 6px",borderRadius:"6px",fontSize:"12px",display:"inline-flex",alignItems:"center",zIndex:5},Ft=(l||"").trim(),Ms=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Lt=a=>{if(!Ft)return a;const x=new RegExp(`(${Ms(Ft)})`,"ig");return a.split(x).map((P,X)=>X%2===1?e.jsx("mark",{className:"bg-[var(--color-gold-cream)] text-gray-900 rounded px-0.5",children:P},X):P)},$s=I?ge?"var(--color-like-active)":N?"var(--color-like-hover)":"var(--color-like)":N?"rgba(107, 114, 128, 0.3)":"none",Is=I?ge?"var(--color-like-active)":N?"var(--color-like-hover)":"var(--color-like)":"#6B7280",Ds=S?"#6B7280":"none",Bs=S?"#6B7280":_?"var(--color-gold)":O?"var(--color-gold-light)":"currentColor",_s=_||O?"0 8px 22px rgba(2,6,23,0.06)":"0 6px 18px rgba(2,6,23,0.07)",Fs=W/20,Ls=W<0?Math.min(8,-W/18):Math.min(2,W/80),Us=Math.min(200,Math.abs(W)),Ps=he?.95:1-Math.min(.04,Us/200),Os=he?`perspective(800px) translateX(-140%) rotate(-20deg) skewY(-18deg) rotateX(12deg) scale(${.86})`:`translateX(${W}px) rotate(${Fs}deg) skewY(${Ls}deg) scale(${Ps})`,Hs=q?"none":he?"transform 420ms cubic-bezier(.2,.8,.2,1), opacity 360ms ease":"transform 300ms cubic-bezier(.22,.9,.35,1)";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:`request-card-${t.id}`,className:"relative mb-6 overflow-visible",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-end px-4 z-0 pointer-events-none",children:e.jsxs("div",{className:"flex items-center text-gray-500 pr-3",style:{opacity:W<0?Math.min(1,-W/160):0},children:[e.jsx(Be,{className:"w-6 h-6 mr-2"}),e.jsx("span",{className:"text-sm font-semibold",children:"Hide"})]})}),e.jsxs("div",{className:`bg-white p-5 pb-4 pr-12 rounded-3xl border border-gray-50 relative z-10 ${b?"pinned-pulse":""}`,style:{boxShadow:"0 10px 30px rgba(2,6,23,0.07), 0 -4px 12px rgba(2,6,23,0.03)",transform:Os,opacity:he?0:1,transition:Hs,touchAction:"pan-y",willChange:"transform, opacity",transformOrigin:"50% 50%"},onTouchStart:rs,onTouchMove:ns,onTouchEnd:a=>{as(),ps(a)},onMouseDown:is,children:[e.jsx("style",{children:`
                    @keyframes dt-heart-pop {
                        0% { transform: translate(-50%, -50%) scale(0.6); opacity: 0.0; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.08)); }
                        30% { transform: translate(-50%, -50%) scale(1.6); opacity: 1; }
                        60% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.9; }
                        100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                    }
                    @keyframes dt-star {
                        0% { transform: translate(-50%, -50%) scale(0.2) translateY(0); opacity: 1; }
                        60% { transform: translate(-50%, -50%) scale(1.05) translateY(-36px); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1) translateY(-56px); opacity: 0; }
                    }
                    .dt-overlay { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 30; }
                    .dt-heart { width: 84px; height: 84px; color: var(--color-like); transform-origin: center center; animation: dt-heart-pop 900ms cubic-bezier(.2,.9,.25,1) forwards; }
                    .dt-burst { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 120px; height: 120px; }
                    .dt-star { position: absolute; left: 50%; top: 50%; display: block; width: 12px; height: 12px; color: #FFD86B; }
                    .dt-star:nth-child(1) { transform: translate(-50%, -50%); animation: dt-star 820ms ease-out 0ms forwards; }
                    .dt-star:nth-child(2) { transform: translate(-50%, -50%); animation: dt-star 820ms ease-out 40ms forwards; transform-origin: 50% 50%; }
                    .dt-star:nth-child(3) { transform: translate(-50%, -50%); animation: dt-star 820ms ease-out 80ms forwards; }
                    .dt-star:nth-child(4) { transform: translate(-50%, -50%); animation: dt-star 820ms ease-out 120ms forwards; }
                    .dt-star:nth-child(5) { transform: translate(-50%, -50%); animation: dt-star 820ms ease-out 160ms forwards; }
                    .dt-star svg { width: 100%; height: 100%; }
                `}),Ie&&e.jsx("div",{className:"dt-overlay",children:e.jsxs("div",{style:{position:"relative",width:0,height:0},children:[e.jsxs("div",{className:"dt-burst","aria-hidden":!0,children:[e.jsx("span",{className:"dt-star",style:{transform:"translate(-20px,-10px)"},children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l1.9 4.1L18 8l-4 2.9L14 15l-2-1.3L10 15l.9-4.1L8 8l4.1-1.9L12 2z"})})}),e.jsx("span",{className:"dt-star",style:{transform:"translate(12px,-6px)"},children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l1.9 4.1L18 8l-4 2.9L14 15l-2-1.3L10 15l.9-4.1L8 8l4.1-1.9L12 2z"})})}),e.jsx("span",{className:"dt-star",style:{transform:"translate(26px,8px)"},children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l1.9 4.1L18 8l-4 2.9L14 15l-2-1.3L10 15l.9-4.1L8 8l4.1-1.9L12 2z"})})}),e.jsx("span",{className:"dt-star",style:{transform:"translate(-26px,6px)"},children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l1.9 4.1L18 8l-4 2.9L14 15l-2-1.3L10 15l.9-4.1L8 8l4.1-1.9L12 2z"})})}),e.jsx("span",{className:"dt-star",style:{transform:"translate(0px,26px)"},children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l1.9 4.1L18 8l-4 2.9L14 15l-2-1.3L10 15l.9-4.1L8 8l4.1-1.9L12 2z"})})})]}),e.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"},children:e.jsx(Ke,{className:"dt-heart"})})]})}),He&&typeof document<"u"&&Ut.createPortal(e.jsx("div",{className:"hint-bubble",style:{position:"fixed",left:ye.left,top:ye.top,transform:"translate(-50%, -120%)",zIndex:9999,pointerEvents:"none"},children:e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsxs("div",{className:"hint-inner",role:"status","aria-live":"polite",children:[e.jsx(it,{className:"w-5 h-5",style:{color:"#fff",flexShrink:0}}),e.jsx("div",{className:"hint-text",children:"Long-press the heart to access more options."})]}),e.jsx("div",{className:ye&&ye.tailClass?ye.tailClass:"hint-tail",style:ye&&ye.tailClass&&ye.tailClass.indexOf("left-edge")!==-1?{top:"50%",left:"-12px",transform:"translateY(-50%)"}:{left:ye&&ye.tailLeft?`${ye.tailLeft}px`:"50%"}})]})}),document.body),e.jsx("div",{className:"absolute top-0 right-0 w-40 sm:w-44 md:w-48 h-40 sm:h-44 md:h-48 rounded-tr-xl overflow-hidden pointer-events-none",style:Es,"aria-hidden":"true"}),A.user&&!(t.creator&&t.creator.id&&A.user.id&&t.creator.id===A.user.id)&&e.jsx("button",{onTouchEnd:a=>a.stopPropagation(),onClick:hs,style:Ts,className:"focus:outline-none hover:text-gray-900 transition duration-150",disabled:L,title:L&&je?`Claimed by ${je.name}`:"Claim this request","aria-label":L&&je?`Claimed by ${je.name}`:"Claim this request",children:L?" Claimed":"CLAIM"}),e.jsxs("div",{onTouchEnd:a=>a.stopPropagation(),className:"absolute top-4 right-4 flex flex-col items-end space-y-1 z-10",children:[t.isOptimistic&&e.jsx("div",{style:{backgroundColor:"#E0F2FE",color:"#0369A1",fontWeight:"bold",padding:"4px 8px",borderRadius:"4px",fontSize:"10px",textTransform:"uppercase",marginBottom:"2px",border:"1px solid #BAE6FD",zIndex:6},children:"PENDING SYNC"}),t.isTrending&&e.jsxs("div",{style:Rs,children:[e.jsx(nt,{className:"w-4 h-4 mr-1",style:{color:G}}),i("Trending",v)]}),e.jsxs("div",{style:As,children:["$",Number(t.funding||0).toFixed(2)]})]}),e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsxs("div",{className:"bg-gray-800 text-white text-xs font-bold px-3 py-1 rounded-full",children:["RANK #",h.rank]})}),w&&e.jsx("button",{onClick:js,"aria-label":w?"Unpin request":"Pin request",className:"absolute z-20 focus:outline-none",style:{top:"2px",left:"44px",transform:"translateY(-50%)",background:"transparent",padding:4,border:"none"},children:e.jsx(Yt,{className:"w-5 h-5",style:{fill:"var(--color-gold)",stroke:"#6b7280"}})}),e.jsx("div",{className:"flex items-start mb-4 relative z-10 pt-10",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{className:"w-10 h-10 rounded-full overflow-hidden mr-3 flex-shrink-0 relative cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all",style:{focusRingColor:"var(--color-gold)"},onClick:a=>{a.stopPropagation(),M&&t.creator&&t.creator.name&&t.creator.name!=="Anonymous"&&M(t.creator.name,!0,{id:t.creator.id||null,avatar:pt(t.creator&&(t.creator.image||t.creator.avatar)?t.creator.image||t.creator.avatar:""),bio:t.creator.bio||"Creating engaging content",stats:{videos:t.creator.videosCount||0,requests:t.creator.requestsCompleted||0,followers:t.creator.followers||t.creator.followerCount||0,following:t.creator.following||0},verified:t.creator.verified||!1,joinedDate:t.creator.joinedYear||new Date().getFullYear()})},children:[e.jsx("img",{src:pt(t.creator&&(t.creator.image||t.creator.avatar)?t.creator.image||t.creator.avatar:""),alt:`${t.company} profile`,className:`w-full h-full object-cover absolute inset-0 z-10 transition-opacity duration-300 ${St?"opacity-0":"opacity-100"}`,onError:Qt,onLoad:()=>dt(!1)}),(()=>{const a=t.creator&&t.creator.name&&t.creator.name!=="Anonymous"?String(t.creator.name).charAt(0).toUpperCase():"U",x=["bg-gray-400","bg-blue-600","bg-indigo-600","bg-green-600","bg-red-600","bg-yellow-500","bg-pink-600"],g=String(t.id||"").split("").reduce((X,te)=>X+te.charCodeAt(0),0),P=t.companyColor||x[g%x.length];return e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white text-xl font-bold ${P}`,style:{opacity:St?1:0,transition:"opacity 0.3s",position:"absolute",inset:0},children:a})})()]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:t.creator&&t.creator.name?t.creator.name==="Anonymous"?"Anonymous":t.creator.name:t.company}),e.jsx("p",{className:"text-xs text-gray-600",children:t.timeAgo})]})]})}),e.jsx("h2",{className:"text-lg font-extrabold text-gray-900 mb-2 leading-tight",children:Lt(t.title)}),e.jsx("p",{className:"text-sm text-gray-800 mb-4",children:Lt(es)}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Et&&e.jsxs("button",{onTouchEnd:a=>a.stopPropagation(),onClick:ts,className:"flex items-center text-sm font-semibold text-gray-600 hover:text-gray-900 transition-colors",children:[Y?i("See less",v):i("See more...",v),Y?e.jsx(oo,{className:"w-4 h-4 ml-1"}):e.jsx(gt,{className:"w-4 h-4 ml-1"})]}),t.isSponsored&&e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Sponsored"})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-4 text-gray-600",children:[e.jsxs("button",{ref:Ne,onTouchStart:a=>{Re(!0),_t(a)},onTouchEnd:a=>{if(ht(),Re(!1),a.stopPropagation(),Ee.current){Ee.current=!1;return}},onMouseDown:a=>{Re(!0),_t(a)},onMouseUp:a=>{ht(),Re(!1)},onMouseEnter:()=>be(!0),onMouseLeave:()=>{be(!1),Re(!1),ht()},onClick:a=>{if(Ee.current){Ee.current=!1;return}ft()},className:`flex items-center space-x-1 p-0 transition-colors transform-gpu hover:scale-105 active:scale-95 ${I?"text-gray-700":"text-gray-500"} focus:outline-none`,children:[e.jsx(Ke,{className:"w-5 h-5 transition-colors",style:{strokeWidth:2,fill:$s,stroke:Is,transition:"transform .12s ease, fill .12s ease, stroke .12s ease"}}),e.jsx("span",{className:"text-xs font-medium",children:ee})]}),e.jsxs("button",{onClick:ls,onTouchEnd:a=>a.stopPropagation(),className:"flex items-center space-x-1 p-0 transition-colors text-gray-500 hover:text-gray-700 focus:outline-none",children:[e.jsx(it,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:t.comments})]}),e.jsxs("button",{onClick:ms,onTouchEnd:a=>a.stopPropagation(),className:"flex items-center space-x-1 p-0 transition-colors text-gray-500 hover:text-gray-700 focus:outline-none",children:[e.jsx(ro,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-xs font-medium",children:[t.boosts," ",i("Boosts",v)]})]})]}),e.jsxs("div",{className:"flex space-x-2",style:{marginRight:"-28px"},children:[A.user&&t.createdBy&&String(A.user.id)===String(t.createdBy)&&!L&&e.jsx("button",{onClick:a=>{a.stopPropagation(),ot(!0)},className:"flex items-center justify-center p-2.5 h-9 w-9 rounded-full bg-white hover:bg-gray-100 transition-colors ring-1 ring-gray-200 hover:shadow-md text-gray-600",title:"Edit request","aria-label":"Edit request",children:e.jsx(Wt,{className:"w-5 h-5"})}),e.jsx("button",{onTouchEnd:a=>{a.stopPropagation(),V(!1)},onTouchStart:()=>V(!0),onMouseEnter:()=>ce(!0),onMouseLeave:()=>{ce(!1),V(!1)},onMouseDown:()=>V(!0),onMouseUp:()=>V(!1),onFocus:()=>ce(!0),onBlur:()=>{ce(!1),V(!1)},onClick:ss,className:"flex items-center justify-center p-2.5 h-9 w-9 rounded-full transition-transform transform-gpu hover:scale-105 active:scale-95 focus:outline-none ring-1 ring-gray-200",style:{boxShadow:_s},children:e.jsx(no,{className:"w-5 h-5 transition-colors",style:{strokeWidth:2,fill:Ds,stroke:Bs,transition:"transform .12s ease, fill .12s ease, stroke .12s ease"}})}),e.jsx("button",{onClick:ds,onTouchEnd:a=>a.stopPropagation(),className:"flex items-center justify-center p-2.5 h-9 w-9 rounded-full bg-white hover:bg-gray-100 transition-colors ring-1 ring-gray-200 hover:shadow-md text-gray-500",children:e.jsx(yt,{className:"w-5 h-5"})}),Kt&&Ut.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>ot(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 relative z-10 w-full max-w-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Edit request"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Update your request details. Changes are visible to everyone."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:vt,onChange:a=>jt(a.target.value),className:"w-full px-3 py-2 border rounded-md"}),e.jsx("textarea",{value:kt,onChange:a=>Nt(a.target.value),className:"w-full px-3 py-2 border rounded-md",rows:6})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>ot(!1),className:"px-4 py-2 rounded-full bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const a=localStorage.getItem("regaarder_token"),x=`${window.location.protocol}//${window.location.hostname}:4000`;try{const g=await fetch(`${x}/requests/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({title:vt,description:kt})});if(!g.ok){const X=await g.json().catch(()=>({error:"Update failed"}));throw new Error(X.error||"Update failed")}const P=await g.json();try{window.dispatchEvent(new CustomEvent("request:updated",{detail:{request:P.request}}))}catch{}ot(!1),De({visible:!0,message:"Request updated"})}catch(g){console.error("Update failed",g),De({visible:!0,message:g.message||"Update failed"})}},className:"px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-gold)",color:"#fff"},children:"Save"})]})]})]}),document.body)]})]})]})]}),e.jsx(po,{isOpen:oe,onClose:cs,requestId:t.id,selectedLanguage:v}),e.jsx(go,{isOpen:le,onClose:us,requestId:t.id,selectedLanguage:v}),e.jsx(lo,{isOpen:B,onClose:fs,requestId:t.id,detailedRank:{...h,totalInfluence:Gt},onGiveLikeFree:()=>{ft(),De({visible:!0,message:"You gave a like  thanks!"})},selectedLanguage:v}),e.jsx(yo,{isOpen:ct,onClose:()=>Ae(!1),onConfirm:xs,selectedLanguage:v}),e.jsx(co,{isOpen:re,onClose:()=>K(!1),onUpgrade:()=>{K(!1),window.location.href="/sponsorship"},onClaimFree:()=>{K(!1)},selectedLanguage:v}),e.jsx(uo,{isOpen:ae,onClose:()=>ne(!1),onUpgrade:()=>{ne(!1),window.location.href="/sponsorship"},onViewLowerValue:()=>{ne(!1)},selectedLanguage:v}),e.jsx(Xe,{message:k.message,isVisible:k.visible,onClose:()=>E({...k,visible:!1}),actionLabel:"Undo",onAction:os,variant:"success"}),e.jsx(Xe,{message:y.message,isVisible:y.visible,onClose:()=>f({...y,visible:!1}),variant:"success"}),e.jsx(Xe,{message:wt.message,isVisible:wt.visible,onClose:()=>De({visible:!1,message:""}),variant:"success"}),Ce&&e.jsxs("div",{ref:ze,style:Ze,className:"z-40",onMouseEnter:()=>{ue.current&&(clearTimeout(ue.current),ue.current=null)},onMouseLeave:()=>{ue.current&&clearTimeout(ue.current),ue.current=setTimeout(()=>we(!1),4e3)},children:[e.jsx("style",{children:`
                        @keyframes fadeScale { 
                            0% { opacity: 0; transform: translateY(6px) scale(0.98); }
                            100% { opacity: 1; transform: translateY(0) scale(1); }
                        }
                    `}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg py-2 px-4 flex flex-col space-y-1 text-sm",style:{animation:"fadeScale 160ms ease-out forwards",minWidth:160},role:"menu","aria-label":"Quick actions",children:[e.jsxs("button",{onClick:gs,className:"px-4 py-2 hover:bg-gray-100 rounded-md text-left w-full flex items-center",role:"menuitem","aria-label":"Dislike",children:[e.jsx(Vt,{className:"w-4 h-4 mr-3",style:{color:"var(--color-like)",fill:Le?"var(--color-like)":"none"}}),"Dislike"]}),e.jsxs("button",{onClick:ws,className:"px-4 py-2 hover:bg-gray-100 rounded-md text-left w-full flex items-center",role:"menuitem","aria-label":"Pin",children:[e.jsx(Yt,{className:"w-4 h-4 mr-3",style:{color:w?"var(--color-gold)":"#9CA3AF",fill:w?"var(--color-gold)":"none"}}),"Pin"]}),e.jsxs("button",{onClick:ys,className:"px-4 py-2 hover:bg-gray-100 rounded-md text-left w-full flex items-center",role:"menuitem","aria-label":"Report",children:[e.jsx(so,{className:"w-4 h-4 mr-3",style:{color:"#9CA3AF"}}),"Report"]}),e.jsxs("button",{onClick:bs,className:"px-4 py-2 hover:bg-gray-100 rounded-md text-left w-full flex items-center",role:"menuitem","aria-label":"Share",children:[e.jsx(ao,{className:"w-4 h-4 mr-3",style:{color:"var(--color-gold)"}}),"Share"]})]})]}),et&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>Me(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 relative z-10 w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:i("Report request",v)}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:i("Please select a reason for reporting  this helps our moderation team prioritize reviews.",v)}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"reportReason",value:"spam",checked:n==="spam",onChange:()=>d("spam")}),e.jsx("span",{className:"text-sm",children:i("Spam or misleading",v)})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"reportReason",value:"harassment",checked:n==="harassment",onChange:()=>d("harassment")}),e.jsx("span",{className:"text-sm",children:i("Harassment or hate",v)})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"reportReason",value:"inaccurate",checked:n==="inaccurate",onChange:()=>d("inaccurate")}),e.jsx("span",{className:"text-sm",children:i("Inaccurate or harmful information",v)})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"reportReason",value:"other",checked:n==="other",onChange:()=>d("other")}),e.jsx("span",{className:"text-sm",children:i("Other",v)})]}),n==="other"&&e.jsx("textarea",{value:c,onChange:a=>r(a.target.value),placeholder:i("Optional: tell us more (max 200 chars)",v),maxLength:200,className:"w-full mt-2 p-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>Me(!1),className:"px-4 py-2 rounded-full bg-gray-100",children:i("Cancel",v)}),e.jsx("button",{onClick:Ns,className:"px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-gold)",color:"#fff"},children:i("Report",v)})]})]})]}),Je&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>$e(!1)}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 relative z-10 w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:i("Share request",v)}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:i("Share this request with others.",v)}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx("button",{onClick:Cs,className:"px-4 py-2 rounded-full text-left",style:{backgroundColor:"#f3f4f6"},children:i("Share via device",v)}),e.jsx("button",{onClick:Bt,className:"px-4 py-2 rounded-full text-left bg-gray-100",children:i("Copy link",v)})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>$e(!1),className:"px-4 py-2 rounded-full bg-white border",children:i("Close",v)})})]})]}),vs&&e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:Dt}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 relative z-10 w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Unpin request?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Are you sure you want to remove this request from your pinned items? It will no longer appear at the top of your feed."}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:Dt,className:"px-4 py-2 rounded-full bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:ks,className:"px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-gold)",color:"#fff"},children:"Unpin"})]})]})]}),e.jsx(Xe,{message:"Youve successfully claimed this request. You now have 48 hours to provide an update or draft.",isVisible:st,onClose:()=>bt(!1)})]})},wo=({name:t,username:h,isCreator:l=!1,onClose:w,profileData:m=null,selectedLanguage:b="English"})=>{const M=new Date().getFullYear(),[v,H]=s.useState(null);s.useEffect(()=>{if(m&&m.avatar){H(m);return}(async()=>{try{const S=h||t,O=await(await fetch("http://localhost:4000/users")).json(),_=(Array.isArray(O.users)?O.users:Array.isArray(O)?O:[]).find(V=>V.id===S||V.email===S||V.name===S||V.name&&V.name.toLowerCase()===String(S).toLowerCase());H(_?{...m,avatar:_.image||_.avatar||null}:m)}catch(S){console.error("Error fetching user profile:",S),H(m)}})()},[h,t,m]);const z=v||m||{avatar:null,bio:l?i("Creating engaging content for you",b):i("Enjoying great content",b),stats:{videos:l?24:0,requests:12,followers:1245},verified:!1,joinedDate:M},G=Qe(),[$,Y]=s.useState(!1);return s.useEffect(()=>{try{const C=m&&m.id||null,S=G.user&&G.user.token||localStorage.getItem("regaarder_token");if(!C||!S)return;fetch(`${window.location.protocol}//${window.location.hostname}:4000/following/${C}`,{headers:{Authorization:`Bearer ${S}`}}).then(J=>J.json()).then(J=>{typeof J.isFollowing<"u"&&Y(!!J.isFollowing)}).catch(()=>{})}catch{}},[m&&m.id,G.user&&G.user.token]),e.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:w,children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-2xl",onClick:C=>C.stopPropagation(),children:[e.jsx("div",{className:"relative h-24",style:{background:"linear-gradient(135deg, rgba(203,138,0,0.1) 0%, rgba(203,138,0,0.05) 100%)"}}),e.jsxs("div",{className:"px-6 pb-6 -mt-12",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-white shadow-lg flex items-center justify-center overflow-hidden",style:{background:z.avatar?"transparent":"linear-gradient(135deg, #e5e7eb 0%, #f3f4f6 100%)"},children:z.avatar?e.jsx("img",{src:z.avatar,alt:t,className:"w-full h-full object-cover"}):e.jsx(io,{className:"w-12 h-12 text-gray-400"})}),l&&z.verified&&e.jsx("div",{className:"absolute bottom-0 right-0 w-7 h-7 rounded-full border-2 border-white flex items-center justify-center shadow-md",style:{backgroundColor:"var(--color-gold)"},children:e.jsx(Gs,{className:"w-3.5 h-3.5 text-white"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:t}),l&&e.jsx("div",{className:"px-2 py-0.5 rounded-full text-xs font-semibold text-white",style:{backgroundColor:"var(--color-gold)"},children:i("Creator",b)})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["@",h||t.replace(/\s+/g,"").toLowerCase()]})]}),z.bio&&e.jsx("p",{className:"text-sm text-gray-600 mt-3 leading-relaxed",children:z.bio}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 py-4 border-y border-gray-100",children:[l&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:z.stats.videos}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:i("Videos",b)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:z.stats.requests}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l?i("Fulfilled",b):i("Requested",b)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:z.stats.followers>=1e3?`${(z.stats.followers/1e3).toFixed(1)}k`:z.stats.followers}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:i("Followers",b)})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("button",{onClick:()=>{const C=m&&m.id||null,S=G.user&&G.user.token||localStorage.getItem("regaarder_token");if(!C||!S){w&&w();return}const J=$?"/unfollow":"/follow";fetch(`${window.location.protocol}//${window.location.hostname}:4000${J}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify({creatorId:C})}).then(O=>O.json()).then(()=>Y(!$)).catch(()=>{})},className:"w-full py-3 rounded-xl font-semibold text-white transition-all hover:opacity-90 shadow-md",style:{backgroundColor:"var(--color-gold)",boxShadow:"0 4px 12px rgba(203, 138, 0, 0.3)"},children:$?i("Following",b):i("Follow",b)}),l&&e.jsx("button",{onClick:()=>console.log(`Request video from ${t}`),className:"w-full py-3 rounded-xl border-2 font-semibold transition-all hover:bg-gray-50",style:{borderColor:"var(--color-gold)",color:"var(--color-gold)"},children:i("Request Video",b)})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-gray-400",children:[i("Member since",b)," ",z.joinedDate]})})]})]})})};function qo(){const t=Qe(),h=Ks(),[l,w]=s.useState(()=>{try{return localStorage.getItem("regaarder_language")||"English"}catch{return"English"}}),[m,b]=s.useState(()=>{try{const n=new URLSearchParams(window.location.search).get("filter");if(["For You","Trending","Newest","Top Funded","Completed"].includes(n))return n}catch{}return"For You"}),[M,v]=s.useState("Requests"),[H,z]=s.useState(""),[G,$]=s.useState(new Set),[Y,C]=s.useState(!1),[S,J]=s.useState("All"),[O,ce]=s.useState("All Time"),[_,V]=s.useState("All"),[W,Q]=s.useState(null),[q,Z]=s.useState(new Date().getMonth()),[F,de]=s.useState(new Date().getFullYear()),[se,he]=s.useState(!1),[pe,xe]=s.useState(!1),[D,u]=s.useState(null),T=s.useRef(null);s.useEffect(()=>{try{const n=new URLSearchParams(h.search).get("filter");n&&["For You","Trending","Newest","Top Funded","Completed"].includes(n)&&b(n)}catch{}},[h.search]),s.useEffect(()=>{try{const n=new URLSearchParams(window.location.search||"").get("q");n&&z(n)}catch{}},[]);const k=2,E=20,I=o=>{const n=o.map(r=>({...r,totalInfluence:r.likes+r.boosts*k})),d=[...n].sort((r,y)=>y.totalInfluence-r.totalInfluence),c={};return d.forEach((r,y)=>{const f=y+1;let B=null;f>1&&(B=d[y-1].totalInfluence);const R=B!==null?B-r.totalInfluence+1:0,re=d.slice(y+1).filter(K=>r.totalInfluence-K.totalInfluence<=E).length;c[r.id]={rank:f,nextRankNeeded:R,nextRankScore:B,threatCount:re,totalInfluence:r.totalInfluence}}),n.map(r=>{const y=c[r.id]||{rank:999,nextRankNeeded:0,threatCount:0};return{...r,...y,pinned:r.pinned||!1,pinnedAt:r.pinnedAt||null}})},[j,N]=s.useState(()=>{const o=I([]);try{const n=localStorage.getItem("pinned_requests_v1");if(n){const d=JSON.parse(n),c=o.map(f=>({...f,pinned:!!d[f.id],pinnedAt:d[f.id]||null})),r=c.filter(f=>f.pinned).sort((f,B)=>(B.pinnedAt||0)-(f.pinnedAt||0)),y=c.filter(f=>!f.pinned);return[...r,...y]}}catch{}return o});s.useEffect(()=>{console.log(`DEBUG: RankedRequests update. Count=${j.length}`);const o=j.filter(n=>n.isOptimistic);o.length>0&&console.warn("DEBUG: Found OPTIMISTIC requests in list:",o.map(n=>n.id)),console.log("DEBUG: Top 3 IDs:",j.slice(0,3).map(n=>n.id))},[j]),s.useEffect(()=>{let o=!1;return(async()=>{try{const n=`${window.location.protocol}//${window.location.hostname}:4000`,d=localStorage.getItem("regaarder_token");let c=new Set;try{const p=await(await fetch(`${n}/bookmarks`,{headers:d?{Authorization:`Bearer ${d}`}:{}})).json();p&&p.success&&Array.isArray(p.requests)&&(p.requests.forEach(oe=>{oe.requestId&&(console.log("Bookmarked requestId:",oe.requestId),c.add(String(oe.requestId)))}),console.log("Bookmarked request IDs set:",Array.from(c)))}catch(ee){console.warn("Failed to fetch request bookmarks:",ee)}const y={"For You":"recommended",Trending:"trending",Newest:"fresh","Top Funded":"funded",Completed:"completed"}[m]||"recommended",f=new URL(`${n}/requests`);f.searchParams.set("feed",y),S&&S!=="All"&&f.searchParams.set("category",S);const B=await fetch(f.toString());if(console.log("[REQUESTS_FETCH] URL:",f.toString(),"status:",B.status),!B.ok)throw new Error("Failed to fetch requests");const R=await B.json();if(console.log("[REQUESTS_FETCH] Backend returned:",R.requests?.length||0,"requests"),window.__DEBUG_REQUESTS_COUNT=R.requests?.length||0,o)return;let re=Array.isArray(R.requests)?R.requests:[];re=(ee=>{let p=[...ee];try{const oe=localStorage.getItem("ideas_requests_v1");if(oe){console.log("Found local optimistic requests:",oe.length,"chars");const U=JSON.parse(oe);if(console.log("Local requests parsed:",U.length,"items"),Array.isArray(U)){const le=new Set(p.map(A=>String(A.id))),me=U.filter(A=>!(!A||!A.id||le.has(String(A.id))));if(console.log("Merging missing optimistic requests:",me.length),me.length>0){const A=me.map(L=>({...L,isOptimistic:!0,likes:L.likes||0,boosts:L.boosts||0,comments:L.comments||0,funding:L.funding||L.amount||0}));A.sort((L,Se)=>new Date(Se.createdAt)-new Date(L.createdAt)),m==="Newest"||m==="For You"||m==="recommended"?p=[...A,...p]:p=[...A,...p],setTimeout(()=>{A.forEach(async L=>{if(!L||L.backendSynced)return;const Se=`sync_attempt_${L.id}`;if(!sessionStorage.getItem(Se)){sessionStorage.setItem(Se,"1"),console.log("Self-healing: Syncing missing request to backend",L.id);try{const je=localStorage.getItem("regaarder_token"),qe={"Content-Type":"application/json"};je&&(qe.Authorization=`Bearer ${je}`);const ct=je?`${n}/requests`:`${n}/requests/public`,Ae={id:L.id,title:L.title,description:L.description,creator:L.creator,createdBy:L.createdBy||(L.creator?L.creator.id:null),meta:L.meta,amount:L.amount||L.funding||0},st=await fetch(ct,{method:"POST",headers:qe,body:JSON.stringify(Ae)});st.ok?console.log("Self-healing: Successfully synced",L.id):(console.warn("Self-healing: Failed to sync",L.id,st.status),sessionStorage.removeItem(Se))}catch(je){console.error("Self-healing error",je),sessionStorage.removeItem(Se)}}})},2e3)}}}}catch(oe){console.warn("Failed to merge local requests:",oe)}return console.log("processLocalRequests returning:",p.length,"total requests"),p})(re);let ae=re.map(ee=>{const p={likes:0,boosts:0,comments:0,funding:0,...ee};p.funding=typeof p.funding=="number"&&p.funding>0?p.funding:typeof p.amount=="number"?p.amount:0,p.company=p.company||p.creator&&(p.creator.name||p.creator.id)||"Community",p.companyInitial=p.companyInitial||(p.company?String(p.company).charAt(0).toUpperCase():"C"),p.companyColor=p.companyColor||"bg-gray-400",p.imageUrl=p.imageUrl||p.creator&&(p.creator.image||p.creator.avatar)||"",p.timeAgo=p.timeAgo||ho(p.createdAt);const oe=c.has(String(p.id));return console.log(`Request ${p.id} bookmarked:`,oe),p.bookmarked=oe,p});try{const ee=Array.from(new Set(ae.filter(p=>p.creator&&p.creator.id).map(p=>p.creator.id)));if(ee.length>0){const oe=(await Promise.all(ee.map(async U=>{try{const le=await fetch(`${window.location.protocol}//${window.location.hostname}:4000/users/${U}`);if(!le.ok)return null;const me=await le.json();return me&&me.user?me.user:null}catch{return null}}))||[]).reduce((U,le)=>(le&&le.id&&(U[le.id]=le),U),{});ae=ae.map(U=>{if(U.creator&&U.creator.id&&oe[U.creator.id]){const le=oe[U.creator.id];U.creator={...U.creator,...le},U.imageUrl=U.imageUrl||le.image||le.avatar||"",U.company=U.company||le.name||U.creator.name||U.creator.id,U.companyInitial=U.companyInitial||(U.company?String(U.company).charAt(0).toUpperCase():"C")}return U})}}catch{}m==="Top Funded"?ae.sort((ee,p)=>(p.funding||0)-(ee.funding||0)):m==="Newest"&&ae.sort((ee,p)=>{const oe=ee.createdAt?new Date(ee.createdAt).getTime():0,U=p.createdAt?new Date(p.createdAt).getTime():0;return isNaN(oe)||isNaN(U)?0:U-oe});const ne=I(ae);try{const ee=localStorage.getItem("pinned_requests_v1");if(ee){const p=JSON.parse(ee),oe=ne.map(me=>({...me,pinned:!!p[me.id],pinnedAt:p[me.id]||null})),U=oe.filter(me=>me.pinned).sort((me,A)=>(A.pinnedAt||0)-(me.pinnedAt||0)),le=oe.filter(me=>!me.pinned);console.log(" SETTING rankedRequests with pinned:",[...U,...le].length),N([...U,...le]);return}}catch{}console.log(" SETTING rankedRequests (no pins):",ne.length),N(ne)}catch(n){console.error(" FETCH ERROR:",n);try{let d=I(qt);try{const c=localStorage.getItem("ideas_requests_v1");if(c){const r=JSON.parse(c);if(Array.isArray(r)&&r.length>0){const y=r.map(f=>({...f,likes:0,boosts:0,comments:0,funding:f.amount||0,isOptimistic:!0,company:f.company||(f.creator?f.creator.name:"Me"),companyInitial:"M",companyColor:"bg-gray-400",timeAgo:"Just now",imageUrl:f.imageUrl||""}));d=I([...y,...qt])}}}catch{}N(d)}catch{}}})(),()=>{o=!0}},[m,S,_,h.search]),s.useEffect(()=>{const o=n=>{try{const d=n&&n.detail?n.detail:null;if(!d)return;console.log("RequestsFeed: received ideas:request_created",d),N(c=>{const r={likes:0,boosts:0,comments:0,funding:0,...d};if(c.some(B=>B.id===r.id))return c;const y=[r,...c.map(B=>({...B}))];return I(y)})}catch{}};return window.addEventListener("ideas:request_created",o),()=>window.removeEventListener("ideas:request_created",o)},[]),s.useEffect(()=>{const o=n=>{try{const{requestId:d,claimedBy:c,claimedAt:r}=n.detail||{};if(!d)return;N(y=>y.map(f=>f.id===d?{...f,claimed:!0,claimedBy:c,claimedAt:r}:f))}catch{}};return window.addEventListener("request:claimed",o),()=>window.removeEventListener("request:claimed",o)},[]),s.useEffect(()=>{const o=c=>{try{const{requestId:r}=c&&c.detail?c.detail:{};if(console.log("RequestsFeed: received comment_added",{requestId:r,detail:c&&c.detail}),typeof r>"u"||r===null)return;N(y=>y.map(f=>String(f.id)===String(r)?{...f,comments:(Number(f.comments)||0)+1}:f))}catch(r){console.warn("RequestsFeed: error handling comment_added",r)}},n=c=>{try{const{requestId:r}=c&&c.detail?c.detail:{};if(console.log("RequestsFeed: received comment_updated",{requestId:r,detail:c&&c.detail}),typeof r>"u"||r===null)return;N(y=>y.map(f=>String(f.id)===String(r)?{...f}:f))}catch(r){console.warn("RequestsFeed: error handling comment_updated",r)}},d=c=>{try{const{requestId:r}=c&&c.detail?c.detail:{};if(console.log("RequestsFeed: received comment_deleted",{requestId:r,detail:c&&c.detail}),typeof r>"u"||r===null)return;N(y=>y.map(f=>String(f.id)===String(r)?{...f,comments:Math.max(0,(Number(f.comments)||0)-1)}:f))}catch(r){console.warn("RequestsFeed: error handling comment_deleted",r)}};return window.addEventListener("request:comment_added",o),window.addEventListener("request:comment_updated",n),window.addEventListener("request:comment_deleted",d),()=>{window.removeEventListener("request:comment_added",o),window.removeEventListener("request:comment_updated",n),window.removeEventListener("request:comment_deleted",d)}},[]),s.useEffect(()=>{const o=n=>{try{const d=n&&n.detail&&n.detail.request?n.detail.request:null;if(!d||!d.id)return;N(c=>c.map(r=>String(r.id)===String(d.id)?{...r,...d}:r))}catch(d){console.warn("RequestsFeed: error handling request:updated",d)}};return window.addEventListener("request:updated",o),()=>window.removeEventListener("request:updated",o)},[]),s.useEffect(()=>{try{const o=t.user&&t.user.token||localStorage.getItem("regaarder_token");if(!o)return;fetch(`${window.location.protocol}//${window.location.hostname}:4000/requests/react/me`,{headers:{Authorization:`Bearer ${o}`}}).then(n=>n.json()).then(n=>{if(n&&n.reactions)try{const d=localStorage.getItem("request_reacts_v1"),r={...d?JSON.parse(d):{},...n.reactions};localStorage.setItem("request_reacts_v1",JSON.stringify(r))}catch{}}).catch(()=>{})}catch{}},[t.user&&t.user.token]),s.useEffect(()=>{(()=>{if(!j||j.length===0)return;const n=new Date,d=new Date(n.getTime()-2160*60*1e3);localStorage.getItem("regaarder_token");let c=null;try{const r=localStorage.getItem("regaarder_user");r&&(c=JSON.parse(r).id)}catch{}for(const r of j){const y=!r.amount||r.amount===0,B=new Date(r.createdAt||r.timestamp)<=d,R=(r.likes||0)===0&&(r.boosts||0)===0&&(r.comments||0)===0&&(r.bookmarks||0)===0&&(r.views||0)===0,re=c&&String(r.createdBy)===String(c);try{if(localStorage.getItem(`nudge_shown_${r.id}`))continue}catch{}if(y&&B&&R&&re){u(r),xe(!0);try{localStorage.setItem(`nudge_shown_${r.id}`,"true")}catch{}break}}})()},[j]);const[be,ge]=s.useState({visible:!1,message:""});s.useEffect(()=>{let o=!1;const n=async()=>{try{const c=t.user&&t.user.token||localStorage.getItem("regaarder_token"),r=c?{Authorization:`Bearer ${c}`}:{},f=await(await fetch(`${window.location.protocol}//${window.location.hostname}:4000/bookmarks`,{headers:r})).json();if(!o&&f&&f.success){const B=new Set((Array.isArray(f.requests)?f.requests:[]).map(R=>String(R.requestId)));$(B),N(R=>R.map(re=>({...re,bookmarked:B.has(String(re.id))})))}}catch(c){console.warn("Failed to sync request bookmarks:",c)}};n();const d=setInterval(n,5e3);return()=>{o=!0,clearInterval(d)}},[t.user]);const[Re,He]=s.useState(null);s.useEffect(()=>{try{const o=localStorage.getItem("requests:navigateTo");o&&(He(String(o)),setTimeout(()=>{try{const n=document.querySelector(`[data-request-id="${String(o)}"]`);n&&n.scrollIntoView&&n.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},600),localStorage.removeItem("requests:navigateTo"))}catch{}},[]);const[_e,ye]=s.useState(!1),[Fe,Ce]=s.useState(null),[we,Ne]=s.useState(!1),[ze,Ze]=s.useState(null),lt=(o,n=!1,d=null)=>{Ce(o),Ne(n),Ze(d),ye(!0)},Te=()=>{ye(!1),Ce(null),Ne(!1),Ze(null)},Ee=o=>{N(n=>{const d=n.find(R=>R.id===o),c=!(d&&d.pinned),r=n.map(R=>R.id===o?{...R,pinned:!R.pinned,pinnedAt:R.pinned?null:Date.now()}:R),y=r.filter(R=>R.pinned).sort((R,re)=>(re.pinnedAt||0)-(R.pinnedAt||0)),f=r.filter(R=>!R.pinned),B=[...y,...f];try{const R={};B.forEach(re=>{re.pinned&&(R[re.id]=re.pinnedAt)}),localStorage.setItem("pinned_requests_v1",JSON.stringify(R))}catch{}return setTimeout(()=>{if(c){try{const R=document.getElementById(`request-card-${o}`);R&&R.scrollIntoView({behavior:"smooth",block:"start"})}catch{}ge({visible:!0,message:"Pinned"});try{He(o),setTimeout(()=>He(null),1200)}catch{}}else ge({visible:!0,message:"Unpinned"})},120),B})},Le=()=>{const[o,n]=s.useState("Requests");s.useEffect(()=>{window.setFooterTab&&(window.currentFooterSetTab=n)},[]);const d=[{name:"Home",Icon:eo},{name:"Requests",Icon:xt},{name:"Ideas",Icon:Wt},{name:"More",Icon:to}],c="rgb(107 114 128)",r=y=>{const B={Home:"home",Requests:"requests",Ideas:"ideas",More:"more"}[y];window.setFooterTab&&window.setFooterTab(B),n(y)};return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:d.map(y=>{const f=y.name===o,B=f?{color:"var(--color-gold)"}:{color:c},R=f?"font-semibold":"font-normal";let re={};return f&&(re.textShadow="0 0 8px var(--color-gold-light)"),e.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:re,children:e.jsxs("button",{className:"flex flex-col items-center w-full",onClick:()=>{r(y.name)},children:[e.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:e.jsx(y.Icon,{size:22,strokeWidth:1,style:B})}),e.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${R}`,style:B,children:i(y.name,l)})]})},y.name)})})})};s.useEffect(()=>{if(!Y)return;const o=n=>{T.current&&!T.current.contains(n.target)&&C(!1)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o)}},[Y]);const[Ye,et]=s.useState(!1);s.useEffect(()=>{try{localStorage.getItem("requests_swipe_entrance_shown")||et(!0)}catch{}},[]);const Me=()=>{try{localStorage.setItem("requests_swipe_entrance_shown","1")}catch{}et(!1)},Je=Array.isArray(j)&&j.some(o=>o.isTrending);s.useEffect(()=>{!Je&&m==="Trending"&&b("Newest")},[Je,m]);const $e=Je?[{name:"For You",Icon:at},{name:"Newest",Icon:Ht},{name:"Trending",Icon:nt},{name:"Top Funded",Icon:zt},{name:"Completed",Icon:xt},{name:"Following",Icon:Ke}]:[{name:"For You",Icon:at},{name:"Newest",Icon:Ht},{name:"Trending",Icon:nt},{name:"Top Funded",Icon:zt},{name:"Completed",Icon:xt},{name:"Following",Icon:Ke}],ue=o=>{let n=o;if(S!=="All"&&(n=n.filter(d=>(d.category||"General")===S)),W)n=n.filter(d=>{if(!d.createdAt)return!1;const c=new Date(d.createdAt),r=new Date(W);return c.toDateString()===r.toDateString()});else if(O!=="All Time"){const d=Date.now();n=n.filter(c=>{const r=c.createdAt?new Date(c.createdAt).getTime():d,y=(d-r)/(1e3*60*60*24);return O==="Today"?y<1:O==="This Week"?y<7:O==="This Month"?y<30:!0})}switch(_!=="All"&&(_==="Completed"?n=n.filter(d=>d.isCompleted===!0):_==="Active"&&(n=n.filter(d=>!d.isCompleted))),m){case"For You":{try{let d=t&&t.user&&t.user.id?String(t.user.id):null;if(!d)try{const c=localStorage.getItem("regaarder_user");if(c){const r=JSON.parse(c);r&&r.id&&(d=String(r.id))}}catch{}return d?[...n].sort((c,r)=>{if(c.isOptimistic&&!r.isOptimistic)return-1;if(r.isOptimistic&&!c.isOptimistic)return 1;const y=String(c.createdBy||c.creator&&c.creator.id)===d?1:0,B=(String(r.createdBy||r.creator&&r.creator.id)===d?1:0)-y;return B!==0?B:new Date(r.createdAt)-new Date(c.createdAt)}):[...n].sort((c,r)=>c.isOptimistic&&!r.isOptimistic?-1:r.isOptimistic&&!c.isOptimistic?1:new Date(r.createdAt)-new Date(c.createdAt))}catch(d){console.warn("Sort For You failed",d)}return n}case"Trending":return n;case"Newest":return[...n].sort((d,c)=>{const r=d.createdAt?new Date(d.createdAt).getTime():0,y=c.createdAt?new Date(c.createdAt).getTime():0;return isNaN(r)||isNaN(y)?0:y-r});case"Top Funded":return[...n].sort((d,c)=>c.funding-d.funding);case"Completed":return n.filter(d=>d.isCompleted===!0);case"Following":return n;default:return n}};let Ie=j.filter(o=>{if(!o||!o.id)return!1;if(!H.trim())return!0;const n=H.trim().toLowerCase();return(o.title||"").toLowerCase().includes(n)||(o.description||"").toLowerCase().includes(n)||(o.company||"").toLowerCase().includes(n)});Ie=ue(Ie),s.useEffect(()=>{try{const n=new URLSearchParams(window.location.search||"").get("reqId");let d=n||null;if(!d&&H){const c=H.toLowerCase(),r=j.find(y=>(y.title||"").toLowerCase().includes(c)||(y.company||"").toLowerCase().includes(c));r&&(d=r.id)}if(!d){const c=localStorage.getItem("focus_request_hint");if(c){const r=JSON.parse(c),y=j.find(f=>(f.title||"").toLowerCase().includes((r.title||"").toLowerCase())||(f.company||"").toLowerCase()===(r.requester||"").toLowerCase());y&&(d=y.id)}}if(d){const c=document.getElementById(`request-card-${d}`);c&&c.scrollIntoView({behavior:"smooth",block:"start"});try{localStorage.removeItem("focus_request_hint")}catch{}}}catch{}},[j,H]);const tt=o=>({backgroundColor:o?"var(--color-neutral-light-bg)":"transparent",color:o?"var(--color-gold)":"#6b7280",borderColor:o?"var(--color-gold-light)":"#e5e7eb",boxShadow:o?"0 0 6px rgba(var(--color-gold-rgb), 0.25)":"none",textShadow:o?"0 0 6px rgba(var(--color-gold-rgb), 0.35)":"none",transition:"all .25s cubic-bezier(.4,0,.2,1)"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32 app-container-light",children:[e.jsxs("header",{className:"sticky top-0 bg-white shadow-sm z-20 pb-2 border-b border-gray-100",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:i("Search requests...",l),value:H,onChange:o=>z(o.target.value),className:"w-full py-3 pl-10 pr-24 bg-gray-100 border border-gray-200 rounded-xl focus:outline-none focus:ring-1 focus:ring-gray-300 text-gray-700 placeholder-gray-500 text-base","aria-label":i("Search requests...",l)}),e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center space-x-2",children:[H&&e.jsx("button",{onClick:()=>z(""),"aria-label":"Clear search",className:"p-1 rounded-full text-gray-500 hover:text-gray-800 hover:bg-gray-200 transition",children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>C(!Y),"aria-label":"Advanced filters",className:"p-1.5 rounded-full text-gray-500 hover:text-gray-800 hover:bg-gray-200 transition relative",style:{backgroundColor:S!=="All"||O!=="All Time"||_!=="All"||W?"var(--color-gold-light)":"transparent",color:S!=="All"||O!=="All Time"||_!=="All"||W?"var(--color-gold)":"#6b7280"},children:[e.jsx(Jt,{className:"w-5 h-5"}),(S!=="All"||O!=="All Time"||_!=="All"||W)&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full",style:{backgroundColor:"var(--color-gold)"}})]})]})]}),Y&&e.jsxs("div",{ref:T,className:"absolute right-4 mt-2 w-72 bg-white rounded-2xl shadow-2xl border border-gray-100 z-30 overflow-hidden",style:{maxHeight:"380px"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 bg-white sticky top-0 z-10",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx(Jt,{className:"w-5 h-5 mr-2",style:{color:"var(--color-gold)"}}),i("Filters",l)]}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-900 p-1 rounded-full transition-colors",children:e.jsx(Be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"overflow-y-auto p-4 pt-2",style:{maxHeight:"280px"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:i("Category",l)}),e.jsx("div",{className:"space-y-1.5",children:["All","Technology","Education","Entertainment","Documentary","Review"].map(o=>e.jsxs("button",{onClick:()=>J(o),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-all ${S===o?"font-semibold":"text-gray-600 hover:bg-gray-50"}`,style:{backgroundColor:S===o?"var(--color-gold-light)":"transparent",color:S===o?"var(--color-gold)":"#4b5563"},children:[S===o&&e.jsx(Ot,{className:"w-4 h-4 inline mr-2"}),i(o,l)]},o))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 mb-2 block flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Zs,{className:"w-4 h-4 mr-1.5"}),i("Date",l)]}),W&&e.jsx("button",{onClick:()=>Q(null),className:"text-xs text-gray-500 hover:text-gray-700",children:i("Clear",l)})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-2",children:(()=>{const o=new Date,n=new Date(F,q,1),c=new Date(F,q+1,0).getDate(),r=n.getDay(),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["S","M","T","W","T","F","S"],B=[];for(let K=0;K<r;K++)B.push(null);for(let K=1;K<=c;K++)B.push(K);const R=()=>{q===0?(Z(11),de(F-1)):Z(q-1)},re=()=>{q===11?(Z(0),de(F+1)):Z(q+1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:R,className:"p-1 hover:bg-gray-200 rounded transition-colors","aria-label":"Previous month",children:e.jsx(gt,{className:"w-4 h-4 transform rotate-90"})}),e.jsxs("button",{onClick:()=>he(!se),className:"text-center font-bold text-xs text-gray-700 hover:bg-gray-200 px-3 py-1 rounded transition-colors",children:[i(y[q],l)," ",F]}),e.jsx("button",{onClick:re,className:"p-1 hover:bg-gray-200 rounded transition-colors","aria-label":"Next month",children:e.jsx(gt,{className:"w-4 h-4 transform -rotate-90"})})]}),se&&e.jsxs("div",{className:"mb-3 bg-white rounded-lg p-3 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:i("Month",l)}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:y.map((K,ae)=>e.jsx("button",{onClick:()=>{Z(ae),he(!1)},className:`px-2 py-1.5 text-xs rounded transition-all ${q===ae?"font-bold shadow-sm":"hover:bg-gray-100"}`,style:{backgroundColor:q===ae?"var(--color-gold)":"transparent",color:q===ae?"white":"#374151"},children:i(K,l)},ae))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:i("Year",l)}),e.jsx("div",{className:"grid grid-cols-3 gap-1 max-h-32 overflow-y-auto",children:(()=>{const K=new Date().getFullYear(),ae=[];for(let ne=K+5;ne>=K-10;ne--)ae.push(ne);return ae.map(ne=>e.jsx("button",{onClick:()=>{de(ne),he(!1)},className:`px-2 py-1.5 text-xs rounded transition-all ${F===ne?"font-bold shadow-sm":"hover:bg-gray-100"}`,style:{backgroundColor:F===ne?"var(--color-gold)":"transparent",color:F===ne?"white":"#374151"},children:ne},ne))})()})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:f.map((K,ae)=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-500 bg-white rounded-md py-1",children:K},ae))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:B.map((K,ae)=>{if(K===null)return e.jsx("div",{},ae);const ne=new Date(F,q,K),ee=W&&new Date(W).toDateString()===ne.toDateString(),p=o.toDateString()===ne.toDateString();return e.jsx("button",{onClick:()=>{Q(ne.toISOString()),ce("All Time")},className:`
                                                                        aspect-square flex items-center justify-center text-xs rounded-md transition-all
                                                                        ${ee?"font-bold shadow-sm":"hover:bg-gray-200"}
                                                                        ${p&&!ee?"ring-1 ring-gray-400":""}
                                                                    `,style:{backgroundColor:ee?"var(--color-gold)":"transparent",color:ee?"white":"#374151"},children:K},ae)})})]})})()})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:i("Status",l)}),e.jsx("div",{className:"space-y-1.5",children:["All","Active","Completed"].map(o=>e.jsxs("button",{onClick:()=>V(o),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-all ${_===o?"font-semibold":"text-gray-600 hover:bg-gray-50"}`,style:{backgroundColor:_===o?"var(--color-gold-light)":"transparent",color:_===o?"var(--color-gold)":"#4b5563"},children:[_===o&&e.jsx(Ot,{className:"w-4 h-4 inline mr-2"}),i(o,l)]},o))})]})]}),(S!=="All"||W||_!=="All")&&e.jsx("div",{className:"p-4 pt-3 border-t border-gray-100 bg-white sticky bottom-0",children:e.jsx("button",{onClick:()=>{J("All"),ce("All Time"),V("All"),Q(null)},className:"w-full py-2.5 rounded-lg text-sm font-semibold transition-all hover:opacity-90",style:{backgroundColor:"var(--color-gold)",color:"white"},children:i("Clear All Filters",l)})})]}),e.jsx("div",{className:"mt-2",children:H.trim()?e.jsxs("p",{className:"text-xs text-gray-500",children:["Showing ",Ie.length," of ",j.length,' "',m,'" results for "',e.jsx("span",{className:"font-medium",children:H.trim()}),'"']}):e.jsxs("p",{className:"text-xs text-gray-400",children:[j.length," ",i(m,l)," ",i("requests",l).toLowerCase()]})})]}),e.jsx("div",{className:"flex overflow-x-scroll no-scrollbar px-4 space-x-2 pb-2",children:$e.map(({name:o,Icon:n})=>{const d=o===m;return e.jsxs("button",{style:tt(d),className:`
                                    flex items-center px-4 py-2 text-sm font-medium rounded-full
                                    border whitespace-nowrap
                                    ${d?"":"hover:bg-gray-100"}
                                    active:scale-[.96]
                                `,onClick:()=>b(o),onTouchEnd:()=>b(o),"aria-pressed":d,"aria-label":`Filter: ${o}`,children:[e.jsx(n,{className:"w-4 h-4 mr-1.5"}),i(o,l)]},o)})})]}),Ye&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:Me}),e.jsxs("div",{className:"relative max-w-sm w-[90%] mx-auto",children:[e.jsx("style",{children:`
                            @keyframes swipeLeftMove { 
                                0% { transform: translateX(24px) scale(1); opacity: 1; }
                                60% { transform: translateX(-18px) scale(.98); opacity: .95; }
                                100% { transform: translateX(-56px) scale(.94); opacity: 0; }
                            }
                            .swipe-hand { animation: swipeLeftMove 1.2s ease-in-out infinite; }
                        `}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 text-center shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx("div",{className:"h-14 w-14 rounded-lg bg-gray-100 flex items-center justify-center mr-3 swipe-hand","aria-hidden":!0,children:e.jsx("div",{style:{width:20,height:20,borderRadius:4,background:"#111827"}})}),e.jsxs("svg",{className:"w-10 h-10 text-gray-400",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("path",{d:"M17 12H7",stroke:"#9CA3AF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 8l-4 4 4 4",stroke:"#9CA3AF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:i("Swipe left to remove a request",l)}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:i("A left swipe clears the request from your feed. Bookmark it if you want to revisit it anytime.",l)}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:Me,className:"px-4 py-2 bg-gray-100 rounded-full font-semibold hover:bg-gray-200",style:{color:"var(--color-gold)"},children:i("Got it",l)})})]})]})]}),e.jsx("main",{className:"px-2 pt-4 max-w-lg mx-auto w-full",children:Ie.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(Pt,{className:"w-10 h-10 text-gray-300 mb-4"}),e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:i("No matches found",l)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i("Try a different keyword or switch filters.",l)})]}):Ie.map(o=>e.jsx("div",{"data-request-id":o.id,children:e.jsx(bo,{request:o,detailedRank:o,searchQuery:H,isPinned:!!o.pinned,onTogglePin:()=>Ee(o.id),pulseActive:Re===o.id,onOpenProfile:lt,selectedLanguage:l,initialBookmarked:G.has(String(o.id)),onBookmarkChange:(n,d)=>{$(c=>{const r=new Set(Array.from(c));return d?r.add(String(n)):r.delete(String(n)),r})}},o.id)},o.id))}),pe&&D&&e.jsx(mo,{nudgeRequest:D,onClose:()=>xe(!1),onBoostRequest:()=>{xe(!1)},onInviteFriends:()=>{xe(!1),window.location.href="/requests?filter=For You"},selectedLanguage:l}),e.jsx(Le,{})," ",e.jsx(Xe,{message:be.message,isVisible:be.visible,onClose:()=>ge({visible:!1,message:""}),variant:"success",selectedLanguage:l}),_e&&e.jsx(wo,{name:Fe,username:Fe,isCreator:we,onClose:Te,profileData:ze,selectedLanguage:l})]})}export{qo as default};
