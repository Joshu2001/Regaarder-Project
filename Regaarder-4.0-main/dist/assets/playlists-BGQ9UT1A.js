import{r as d,j as t,g as P}from"./index-CVpeJt5r.js";import{u as W}from"./navigation-C4DKzRs6.js";import{L as A}from"./list-plus-eBux8eMf.js";import{P as R,M,F as H}from"./pencil-g6xkndFt.js";import{B as _}from"./bookmark-Dx5-nucN.js";import{L as z}from"./lightbulb-CiqIREr2.js";import{H as O}from"./home-CvLImcbo.js";const D="playlists_v1";function j(){try{const o=localStorage.getItem(D),s=o?JSON.parse(o):{lists:[]};return Array.isArray(s)?{lists:s}:{lists:Array.isArray(s.lists)?s.lists:[]}}catch{return{lists:[]}}}function v(o){try{localStorage.setItem(D,JSON.stringify({lists:o.lists||[]}))}catch{}try{window.dispatchEvent(new CustomEvent("playlists:updated"))}catch{}}function f(){return j().lists}function ne(o){v({lists:o})}function q(o){const s=j(),r=String(o||"Playlist").trim()||"Playlist";let a=s.lists.find(c=>c.name.toLowerCase()===r.toLowerCase());return a||(a={id:`pl_${Date.now()}`,name:r,items:[],createdAt:new Date().toISOString()},s.lists.unshift(a),v(s)),a}function J(o){return q(o)}function K(o,s){const r=j(),a=r.lists.findIndex(c=>c.id===o);a>=0&&(r.lists[a]={...r.lists[a],name:String(s||"").trim()||r.lists[a].name},v(r))}function F(o){const s=j();s.lists=s.lists.filter(r=>r.id!==o),v(s)}function V(o,s){if(!o||!s)return;const r=j(),a=r.lists.find(u=>u.id===o);if(!a)return;const c={id:String(s.id||s.videoId||s.url||s.src||Date.now()),url:s.url||s.src||s.videoUrl||null,title:s.title||"",thumbnail:s.imageUrl||s.thumbnail||"",author:s.author||"",requester:s.requester||"",addedAt:new Date().toISOString()};a.items.some(u=>String(u.id)===String(c.id))||a.items.unshift(c),v(r)}function G(o,s){const r=j(),a=r.lists.find(c=>c.id===o);a&&(a.items=(a.items||[]).filter(c=>String(c.id)!==String(s)),v(r))}function le(){W();const o=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",s=e=>P(e,o),[r,a]=d.useState(f()),[c,x]=d.useState(()=>r[0]?.id||null),[u,h]=d.useState("");d.useEffect(()=>{const e=()=>a(f());window.addEventListener("playlists:updated",e);const n=setInterval(e,8e3);return()=>{window.removeEventListener("playlists:updated",e),clearInterval(n)}},[]);const l=d.useMemo(()=>r.find(e=>e.id===c)||r[0]||null,[r,c]),[p,y]=d.useState(!1),[C,N]=d.useState(""),[S,w]=d.useState(""),[U,k]=d.useState(null),[E,L]=d.useState(""),b=d.useRef({}),$=()=>{N(""),w(""),y(!0)},X=()=>{const e=(C||"").trim();if(!e){w(s("Please enter a name"));return}if(r.some(g=>g.name.toLowerCase()===e.toLowerCase())){w(s("A playlist with this name already exists"));return}const m=J(e),i=f();a(i),x(m.id),y(!1)},T=()=>{y(!1)},I=(l?.items||[]).filter(e=>{const n=u.trim().toLowerCase();return n?(e.title||"").toLowerCase().includes(n)||(e.author||"").toLowerCase().includes(n)||(e.requester||"").toLowerCase().includes(n):!0}),B=e=>{const n=e.url||e.id;if(!n)return;const m=new URLSearchParams({src:n,title:e.title||""});window.location.href=`/videoplayer?${m.toString()}`};return t.jsxs("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:[t.jsxs("div",{className:"w-full flex flex-col bg-white overflow-hidden",children:[t.jsxs("header",{className:"p-4 border-b border-gray-100 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h1",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(A,{className:"w-5 h-5 text-gray-500",strokeWidth:1.5}),t.jsx("span",{children:s("Playlist")})]}),t.jsx("div",{className:"flex items-center",children:t.jsx("button",{onClick:$,className:"text-sm font-medium hover:opacity-80 transition",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px",marginLeft:"auto"},children:s("New")})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[t.jsxs("svg",{className:"w-4 h-4 text-gray-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("path",{d:"m21 21-4.3-4.3"})]}),t.jsx("input",{value:u,onChange:e=>h(e.target.value),placeholder:s("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),t.jsx("select",{value:l?.id||"",onChange:e=>x(e.target.value),className:"ml-4 px-2 py-2 border border-gray-200 rounded-md text-sm",children:r.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),t.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-6",children:[r.length>0&&t.jsx("div",{className:"w-full grid grid-cols-2 gap-4",children:r.map(e=>{const n=e.items&&e.items[0]&&(e.items[0].thumbnail||e.items[0].imageUrl)||"https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(s("Playlist")),m=e.id===l?.id;return t.jsxs("button",{onClick:i=>{if(i.currentTarget.dataset.longpressed==="1"){i.currentTarget.dataset.longpressed="0";return}x(e.id)},className:`w-full text-left bg-white rounded-2xl border ${m?"border-[var(--color-gold)]":"border-gray-200"} overflow-hidden hover:border-gray-300 transition`,onMouseDown:i=>{b.current[e.id]=setTimeout(()=>{try{if(i.currentTarget.dataset.longpressed="1",confirm(s("Delete this playlist?"))){F(e.id);const g=f();a(g),x(g[0]?.id||null)}}catch{}},700)},onMouseUp:i=>{clearTimeout(b.current[e.id])},onMouseLeave:i=>{clearTimeout(b.current[e.id])},onTouchStart:i=>{b.current[e.id]=setTimeout(()=>{try{if(i.currentTarget.dataset.longpressed="1",confirm(s("Delete this playlist?"))){F(e.id);const g=f();a(g),x(g[0]?.id||null)}}catch{}},700)},onTouchEnd:i=>{clearTimeout(b.current[e.id])},children:[t.jsx("div",{className:"w-full pb-[56%] relative",children:t.jsx("img",{src:n,alt:e.name,className:"absolute inset-0 w-full h-full object-cover",onError:i=>{i.currentTarget.src="https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(s("Playlist"))}})}),t.jsxs("div",{className:"px-3 py-2 relative",children:[U===e.id?t.jsx("input",{autoFocus:!0,value:E,onChange:i=>L(i.target.value),onBlur:()=>{try{K(e.id,(E||"").trim()||e.name),a(f())}catch{}k(null)},onKeyDown:i=>{i.key==="Enter"&&i.currentTarget.blur()},className:"w-full text-base font-semibold text-gray-900 truncate outline-none"}):t.jsx("div",{className:"text-base font-semibold text-gray-900 truncate",children:e.name}),t.jsx("button",{onClick:i=>{i.stopPropagation(),k(e.id),L(e.name||"")},className:"absolute top-2 right-2 p-1 text-gray-600 hover:text-gray-900",children:t.jsx(R,{className:"w-4 h-4"})}),t.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[t.jsx("span",{children:s("Private")}),t.jsx("span",{children:"•"}),t.jsx("span",{children:(e.items||[]).length}),t.jsx(_,{className:"w-3.5 h-3.5 ml-auto text-gray-400"})]})]})]},e.id)})}),l?I.length>0?t.jsx("div",{className:"w-full space-y-4",children:I.map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>B(e),onTouchStart:n=>{n.currentTarget.dataset.startX=n.touches[0].clientX},onTouchMove:n=>{const m=parseFloat(n.currentTarget.dataset.startX||"0"),i=n.touches[0].clientX-m;n.currentTarget.style.transform=`translateX(${i}px)`},onTouchEnd:n=>{const m=parseFloat(n.currentTarget.dataset.startX||"0"),i=n.changedTouches[0].clientX-m;n.currentTarget.style.transform="",i<-80&&(G(l.id,e.id),a(f())),n.currentTarget.dataset.startX="0"},children:[t.jsx("img",{src:e.thumbnail||"https://placehold.co/160x90/efefef/777?text=Video",alt:e.title,className:"w-40 h-24 object-cover rounded-md",onError:n=>{n.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||e.url||e.id}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[e.author,e.author&&e.requester?" • ":"",e.requester]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Added • ",new Date(e.addedAt).toLocaleString()]})]}),t.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:n=>{n.stopPropagation();const m=e.url?`${window.location.origin}/videoplayer?src=${encodeURIComponent(e.url)}&title=${encodeURIComponent(e.title||"")}`:window.location.href,i={title:e.title||"Watch this",text:e.title||"Watch this",url:m};if(navigator.share)navigator.share(i).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(m),alert(s("Share link copied"))}catch{}},children:t.jsx(M,{className:"w-5 h-5"})})]},`${l.id}:${e.id}`))}):t.jsxs("div",{className:"w-full space-y-3",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[s("Playlist")," “",l.name,"” ",s("has no videos yet")]}),t.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,138,0,0.06)"},children:[t.jsx(z,{className:"w-4 h-4 mt-0.5 text-[var(--color-gold)] flex-shrink-0"}),t.jsx("p",{className:"text-xs leading-relaxed font-medium",children:s("Use “Add to playlist” from a video’s options to start filling this list. Swipe left on items to remove.")})]})]}):t.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center space-y-4 pt-8",children:[t.jsx(A,{className:"w-16 h-16 text-gray-400",strokeWidth:1}),t.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:s("No playlists yet")}),t.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:s("Create your first playlist to organize favorite videos")})]})]}),t.jsx(Q,{})]}),p&&t.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:T,children:t.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("Create Playlist")}),t.jsx("button",{className:"p-1 text-gray-500 hover:text-gray-700",onClick:T,children:"✕"})]}),t.jsx("label",{className:"text-sm text-gray-700",children:s("Name")}),t.jsx("input",{value:C,onChange:e=>{N(e.target.value),w("")},placeholder:s("My Playlist"),className:"mt-1 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md outline-none"}),S&&t.jsx("div",{className:"text-xs text-red-600 mt-1",children:S}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 text-sm text-gray-700",onClick:T,children:s("Cancel")}),t.jsx("button",{className:"px-3 py-2 text-sm text-white rounded-md",style:{backgroundColor:"var(--color-gold)"},onClick:X,children:s("Create")})]})]})})]})}const Q=()=>{const o=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",s=l=>P(l,o),[r,a]=d.useState(null),c=d.useRef(!1),x=[{id:"Home",name:s("Home"),icon:O},{id:"Requests",name:s("Requests"),icon:H},{id:"Ideas",name:s("Ideas"),icon:R},{id:"More",name:s("More"),icon:M}],u="rgb(107 114 128)",h=l=>{try{if(l==="Home"){window.location.href="/home.jsx";return}if(l==="Requests"){window.location.href="/requests.jsx";return}if(l==="Ideas"){window.location.href="/ideas.jsx";return}if(l==="More"){window.location.href="/more.jsx";return}}catch(p){console.warn("Navigation failed",p)}};return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:x.map(l=>{const p=l.id===r,y=p?{color:"var(--color-gold)"}:{color:u},C=p?"font-semibold":"font-normal";let N={};p&&(N.textShadow="0 0 8px var(--color-gold-light)");const S=l.icon;return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:N,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{a(l.id),c.current||(c.current=!0,h(l.id))},onTouchStart:()=>{a(l.id),c.current||(c.current=!0,h(l.id))},onClick:w=>{if(c.current){c.current=!1,w.preventDefault();return}a(l.id),h(l.id)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(S,{size:22,strokeWidth:1.5,style:y})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${C}`,style:y,children:l.name})]})},l.id)})})})};async function ie(o){const s=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",r=a=>P(a,s);try{const c=f().map(l=>l.name),x=r("Add to playlist")+`:
`+(c.length?r("Existing: ")+c.join(", "):r("No playlists yet")),u=prompt(x,c[0]||r("My Playlist"));if(!u)return!1;const h=q(u);return V(h.id,o),!0}catch{return!1}}export{V as addToPlaylist,J as createPlaylist,le as default,F as deletePlaylist,q as ensurePlaylist,f as getPlaylists,ie as promptAddToPlaylist,G as removeFromPlaylist,K as renamePlaylist,ne as setPlaylists};
