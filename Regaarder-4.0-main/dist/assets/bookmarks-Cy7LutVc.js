import{R as d,j as t,g as U}from"./index-J--XMc-5.js";import{B as E}from"./bookmark-DgaFaiie.js";import{M as A,H as M,F as R,P as _}from"./pencil-Dw1rFXCt.js";import{S as L}from"./search-nPl8B-fm.js";import{H as B}from"./history-B2tcnVG_.js";const k=typeof window<"u"?window.__BACKEND_URL__||`${window.location.protocol}//${window.location.hostname}:4000`:"http://localhost:4000",I=u=>{try{const h=Math.max(0,Math.floor(Number(u)||0)),i=Math.floor(h/60),v=String(h%60).padStart(2,"0");return`${i}:${v}`}catch{return"0:00"}};function W(){const[u,h]=d.useState(""),[i,v]=d.useState([]),[f,N]=d.useState([]),[p,n]=d.useState([]),[l,S]=d.useState({}),[c,x]=d.useState({}),[j,y]=d.useState(localStorage.getItem("regaarder_language")||"English"),r=e=>U(e,j);d.useEffect(()=>{const e=()=>{y(localStorage.getItem("regaarder_language")||"English")};window.addEventListener("storage",e);const s=setInterval(()=>{const o=localStorage.getItem("regaarder_language")||"English";o!==j&&y(o)},1e3);return()=>{window.removeEventListener("storage",e),clearInterval(s)}},[j]);const b=d.useCallback(async()=>{try{const e=localStorage.getItem("regaarder_token");console.log("Fetching bookmarks with token:",!!e);const s=await fetch(`${k}/bookmarks`,{headers:e?{Authorization:`Bearer ${e}`}:{}}).then(o=>o.json()).catch(()=>null);console.log("Bookmarks response:",s),s&&s.success&&(console.log("Segments:",s.segments?.length||0,"Videos:",s.videos?.length||0,"Requests:",s.requests?.length||0),s.requests&&s.requests.length>0&&console.log("Request bookmarks:",s.requests.map(o=>({id:o.id,requestId:o.requestId,title:o.title}))),v(Array.isArray(s.segments)?s.segments:[]),N(Array.isArray(s.videos)?s.videos:[]),n(Array.isArray(s.requests)?s.requests:[]));try{const o=await fetch(`${k}/videos`).then(g=>g.json()).catch(()=>null),a=o&&o.success&&Array.isArray(o.videos)?o.videos:[],m={};a.forEach(g=>{const $=g.videoUrl||g.url;$&&(m[String($)]={thumbnail:g.imageUrl||g.thumbnail||"",title:g.title||""})}),S(m)}catch{}}catch{}},[]),C=e=>{const s=f.find(a=>a.id===e);if(!s)return;const o=localStorage.getItem("regaarder_token");fetch(`${k}/bookmarks/videos`,{method:"DELETE",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({videoUrl:s.videoUrl})}).then(()=>{N(a=>a.filter(m=>m.id!==e))}).catch(()=>{})},T=e=>{const s=p.find(a=>a.id===e);if(!s)return;const o=localStorage.getItem("regaarder_token");fetch(`${k}/bookmarks/requests`,{method:"DELETE",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({requestId:s.requestId})}).then(()=>{n(a=>a.filter(m=>m.id!==e))}).catch(()=>{})};d.useEffect(()=>{b();const e=setInterval(b,5e3);return()=>clearInterval(e)},[b]);const q=(e,s=0,o="")=>{try{window.location.href=`/videoplayer?src=${encodeURIComponent(e)}&title=${encodeURIComponent(o||"")}&t=${Math.max(0,Math.floor(s||0))}`}catch{}},w=e=>{const s=u.trim().toLowerCase();return s?String(e||"").toLowerCase().includes(s):!0};return t.jsx("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:t.jsxs("div",{className:"w-full flex flex-col bg-white overflow-auto",children:[t.jsxs("header",{className:"p-4 border-b border-gray-100 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h1",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(E,{className:"w-5 h-5 text-gray-500",strokeWidth:1.5}),t.jsx("span",{children:r("Bookmarks")})]}),t.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"More",children:t.jsx(A,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[t.jsx(L,{className:"w-4 h-4 text-gray-500"}),t.jsx("input",{value:u,onChange:e=>h(e.target.value),placeholder:r("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),t.jsxs("p",{className:"text-sm text-gray-500 ml-4 whitespace-nowrap",children:[i.length+f.length+p.length," ",r("items")]})]})]}),t.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-8",children:[t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:r("Timestamped Segments")}),i.length===0?t.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[t.jsx(B,{className:"w-4 h-4"}),t.jsx("span",{children:r("No timestamped segments yet")})]}):t.jsx("div",{className:"space-y-3",children:i.filter(e=>w(e.label)||w(e.videoUrl)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>q(e.videoUrl,e.startTime,e.label||l[String(e.videoUrl)]?.title||""),children:[t.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:l[String(e.videoUrl)]?.thumbnail?`url(${l[String(e.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.label||l[String(e.videoUrl)]?.title||e.videoUrl}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Start ",I(e.startTime)," â€¢ End ",I(e.endTime)]}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:r("Videos to Watch")}),f.length===0?t.jsx("div",{className:"text-gray-500",children:r("No video bookmarks")}):t.jsx("div",{className:"space-y-3",children:f.filter(e=>w(e.title)||w(e.videoUrl)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${c[e.id]||0}px)`,transition:(c[e.id]||0)===0?"transform 0.3s ease":"none"},onTouchStart:s=>{s.stopPropagation(),x(o=>({...o,[`${e.id}_startX`]:s.touches[0].clientX}))},onTouchMove:s=>{s.stopPropagation();const o=c[`${e.id}_startX`]||0,a=s.touches[0].clientX-o;a<0&&x(m=>({...m,[e.id]:a}))},onTouchEnd:s=>{s.stopPropagation(),(c[e.id]||0)<-80?C(e.id):x(a=>({...a,[e.id]:0}))},onClick:s=>{Math.abs(c[e.id]||0)<5&&q(e.videoUrl,0,e.title||l[String(e.videoUrl)]?.title||"")},children:[t.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:l[String(e.videoUrl)]?.thumbnail?`url(${l[String(e.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||l[String(e.videoUrl)]?.title||e.videoUrl}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:r("Request Bookmarks")}),p.length===0?t.jsx("div",{className:"text-gray-500",children:r("No request bookmarks")}):t.jsx("div",{className:"space-y-3",children:p.filter(e=>w(e.title)||w(e.requestId)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${c[e.id]||0}px)`,transition:(c[e.id]||0)===0?"transform 0.3s ease":"none"},onTouchStart:s=>{s.stopPropagation(),x(o=>({...o,[`${e.id}_startX`]:s.touches[0].clientX}))},onTouchMove:s=>{s.stopPropagation();const o=c[`${e.id}_startX`]||0,a=s.touches[0].clientX-o;a<0&&x(m=>({...m,[e.id]:a}))},onTouchEnd:s=>{s.stopPropagation(),(c[e.id]||0)<-80?T(e.id):x(a=>({...a,[e.id]:0}))},onClick:()=>{if(Math.abs(c[e.id]||0)<5){try{localStorage.setItem("focus_request_hint",JSON.stringify({title:e.title||""}))}catch{}const s=encodeURIComponent(e.title||""),o=encodeURIComponent(e.requestId||"");window.location.href=`/requests.jsx${o?`?reqId=${o}`:""}${s?`${o?"&":"?"}q=${s}`:""}`}},children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:"R"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||e.requestId}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderWidth:"1px",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,139,4,0.06)"},children:[t.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-gold)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),t.jsx("p",{className:"text-xs leading-relaxed font-medium",children:r("Swipe left to delete bookmark")})]})]}),t.jsx(D,{})]})})}const D=()=>{const[u,h]=d.useState(null),i=d.useRef(!1),v=localStorage.getItem("regaarder_language")||"English",f=n=>U(n,v),N=[{name:"Home",icon:M},{name:"Requests",icon:R},{name:"Ideas",icon:_},{name:"More",icon:A}],p="rgb(107 114 128)";return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:N.map(n=>{const l=n.name===u,S=l?{color:"var(--color-gold)"}:{color:p},c=l?"font-semibold":"font-normal";let x={};l&&(x.textShadow="0 0 8px var(--color-gold-light)");const j=n.icon,y=r=>{try{if(r==="Home"){window.location.href="/home.jsx";return}if(r==="Requests"){window.location.href="/requests.jsx";return}if(r==="Ideas"){window.location.href="/ideas.jsx";return}if(r==="More"){window.location.href="/more.jsx";return}}catch(b){console.warn("Navigation failed",b)}};return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:x,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{h(n.name),i.current||(i.current=!0,y(n.name))},onTouchStart:()=>{h(n.name),i.current||(i.current=!0,y(n.name))},onClick:r=>{if(i.current){i.current=!1,r.preventDefault();return}h(n.name),y(n.name)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(j,{size:22,strokeWidth:1.5,style:S})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${c}`,style:S,children:f(n.name)})]})},n.name)})})})};export{W as default};
