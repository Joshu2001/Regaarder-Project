import{u as E,R as l,j as t,g as U}from"./index-BXAfRrUC.js";import{C as M}from"./chevron-left-BlqxmpqF.js";import{S as R}from"./search-CPDhCJlp.js";import{H as _}from"./history-CwcKUfrL.js";import{H as L}from"./home-Bw8MpRF6.js";import{F as B,P as D,M as X}from"./pencil-CIekxqgt.js";const N=typeof window<"u"?window.__BACKEND_URL__||`${window.location.protocol}//${window.location.hostname}:4000`:"http://localhost:4000",C=j=>{try{const h=Math.max(0,Math.floor(Number(j)||0)),d=Math.floor(h/60),u=String(h%60).padStart(2,"0");return`${d}:${u}`}catch{return"0:00"}};function O(){const j=E(),[h,d]=l.useState(""),[u,S]=l.useState([]),[y,b]=l.useState([]),[r,v]=l.useState([]),[c,k]=l.useState({}),[n,g]=l.useState({}),[f,x]=l.useState(localStorage.getItem("regaarder_language")||"English"),i=e=>U(e,f);l.useEffect(()=>{const e=()=>{x(localStorage.getItem("regaarder_language")||"English")};window.addEventListener("storage",e);const s=setInterval(()=>{const o=localStorage.getItem("regaarder_language")||"English";o!==f&&x(o)},1e3);return()=>{window.removeEventListener("storage",e),clearInterval(s)}},[f]);const q=l.useCallback(async()=>{try{const e=localStorage.getItem("regaarder_token");console.log("Fetching bookmarks with token:",!!e);const s=await fetch(`${N}/bookmarks`,{headers:e?{Authorization:`Bearer ${e}`}:{}}).then(o=>o.json()).catch(()=>null);console.log("Bookmarks response:",s),s&&s.success&&(console.log("Segments:",s.segments?.length||0,"Videos:",s.videos?.length||0,"Requests:",s.requests?.length||0),s.requests&&s.requests.length>0&&console.log("Request bookmarks:",s.requests.map(o=>({id:o.id,requestId:o.requestId,title:o.title}))),S(Array.isArray(s.segments)?s.segments:[]),b(Array.isArray(s.videos)?s.videos:[]),v(Array.isArray(s.requests)?s.requests:[]));try{const o=await fetch(`${N}/videos`).then(p=>p.json()).catch(()=>null),a=o&&o.success&&Array.isArray(o.videos)?o.videos:[],m={};a.forEach(p=>{const I=p.videoUrl||p.url;I&&(m[String(I)]={thumbnail:p.imageUrl||p.thumbnail||"",title:p.title||""})}),k(m)}catch{}}catch{}},[]),A=e=>{const s=y.find(a=>a.id===e);if(!s)return;const o=localStorage.getItem("regaarder_token");fetch(`${N}/bookmarks/videos`,{method:"DELETE",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({videoUrl:s.videoUrl})}).then(()=>{b(a=>a.filter(m=>m.id!==e))}).catch(()=>{})},T=e=>{const s=r.find(a=>a.id===e);if(!s)return;const o=localStorage.getItem("regaarder_token");fetch(`${N}/bookmarks/requests`,{method:"DELETE",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({requestId:s.requestId})}).then(()=>{v(a=>a.filter(m=>m.id!==e))}).catch(()=>{})};l.useEffect(()=>{q();const e=setInterval(q,5e3);return()=>clearInterval(e)},[q]);const $=(e,s=0,o="")=>{try{window.location.href=`/videoplayer?src=${encodeURIComponent(e)}&title=${encodeURIComponent(o||"")}&t=${Math.max(0,Math.floor(s||0))}`}catch{}},w=e=>{const s=h.trim().toLowerCase();return s?String(e||"").toLowerCase().includes(s):!0};return t.jsx("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:t.jsxs("div",{className:"w-full flex flex-col bg-white overflow-auto",children:[t.jsx("header",{className:"bg-white border-b border-gray-100 p-4 sticky top-0 z-20",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(M,{className:"w-6 h-6 text-gray-700 cursor-pointer transition hover:text-gray-900",onClick:()=>j(-1)}),t.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:i("Bookmarks")})]})}),t.jsx("div",{className:"p-4 space-y-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[t.jsx(R,{className:"w-4 h-4 text-gray-500"}),t.jsx("input",{value:h,onChange:e=>d(e.target.value),placeholder:i("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),t.jsxs("p",{className:"text-sm text-gray-500 ml-4 whitespace-nowrap",children:[u.length+y.length+r.length," ",i("items")]})]})}),t.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-8",children:[t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:i("Timestamped Segments")}),u.length===0?t.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[t.jsx(_,{className:"w-4 h-4"}),t.jsx("span",{children:i("No timestamped segments yet")})]}):t.jsx("div",{className:"space-y-3",children:u.filter(e=>w(e.label)||w(e.videoUrl)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>$(e.videoUrl,e.startTime,e.label||c[String(e.videoUrl)]?.title||""),children:[t.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:c[String(e.videoUrl)]?.thumbnail?`url(${c[String(e.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.label||c[String(e.videoUrl)]?.title||e.videoUrl}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Start ",C(e.startTime)," â€¢ End ",C(e.endTime)]}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:i("Videos to Watch")}),y.length===0?t.jsx("div",{className:"text-gray-500",children:i("No video bookmarks")}):t.jsx("div",{className:"space-y-3",children:y.filter(e=>w(e.title)||w(e.videoUrl)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${n[e.id]||0}px)`,transition:(n[e.id]||0)===0?"transform 0.3s ease":"none"},onTouchStart:s=>{s.stopPropagation(),g(o=>({...o,[`${e.id}_startX`]:s.touches[0].clientX}))},onTouchMove:s=>{s.stopPropagation();const o=n[`${e.id}_startX`]||0,a=s.touches[0].clientX-o;a<0&&g(m=>({...m,[e.id]:a}))},onTouchEnd:s=>{s.stopPropagation(),(n[e.id]||0)<-80?A(e.id):g(a=>({...a,[e.id]:0}))},onClick:s=>{Math.abs(n[e.id]||0)<5&&$(e.videoUrl,0,e.title||c[String(e.videoUrl)]?.title||"")},children:[t.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:c[String(e.videoUrl)]?.thumbnail?`url(${c[String(e.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||c[String(e.videoUrl)]?.title||e.videoUrl}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("section",{className:"w-full",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:i("Request Bookmarks")}),r.length===0?t.jsx("div",{className:"text-gray-500",children:i("No request bookmarks")}):t.jsx("div",{className:"space-y-3",children:r.filter(e=>w(e.title)||w(e.requestId)).map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${n[e.id]||0}px)`,transition:(n[e.id]||0)===0?"transform 0.3s ease":"none"},onTouchStart:s=>{s.stopPropagation(),g(o=>({...o,[`${e.id}_startX`]:s.touches[0].clientX}))},onTouchMove:s=>{s.stopPropagation();const o=n[`${e.id}_startX`]||0,a=s.touches[0].clientX-o;a<0&&g(m=>({...m,[e.id]:a}))},onTouchEnd:s=>{s.stopPropagation(),(n[e.id]||0)<-80?T(e.id):g(a=>({...a,[e.id]:0}))},onClick:()=>{if(Math.abs(n[e.id]||0)<5){try{localStorage.setItem("focus_request_hint",JSON.stringify({title:e.title||""}))}catch{}const s=encodeURIComponent(e.title||""),o=encodeURIComponent(e.requestId||"");window.location.href=`/requests.jsx${o?`?reqId=${o}`:""}${s?`${o?"&":"?"}q=${s}`:""}`}},children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:"R"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||e.requestId}),e.createdAt&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]}),t.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderWidth:"1px",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,139,4,0.06)"},children:[t.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-gold)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),t.jsx("p",{className:"text-xs leading-relaxed font-medium",children:i("Swipe left to delete bookmark")})]})]}),t.jsx(P,{})]})})}const P=()=>{const[j,h]=l.useState(null),d=l.useRef(!1),u=localStorage.getItem("regaarder_language")||"English",S=r=>U(r,u),y=[{name:"Home",icon:L},{name:"Requests",icon:B},{name:"Ideas",icon:D},{name:"More",icon:X}],b="rgb(107 114 128)";return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:y.map(r=>{const v=r.name===j,c=v?{color:"var(--color-gold)"}:{color:b},k=v?"font-semibold":"font-normal";let n={};v&&(n.textShadow="0 0 8px var(--color-gold-light)");const g=r.icon,f=x=>{try{if(x==="Home"){window.location.href="/home.jsx";return}if(x==="Requests"){window.location.href="/requests.jsx";return}if(x==="Ideas"){window.location.href="/ideas.jsx";return}if(x==="More"){window.location.href="/more.jsx";return}}catch(i){console.warn("Navigation failed",i)}};return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:n,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{h(r.name),d.current||(d.current=!0,f(r.name))},onTouchStart:()=>{h(r.name),d.current||(d.current=!0,f(r.name))},onClick:x=>{if(d.current){d.current=!1,x.preventDefault();return}h(r.name),f(r.name)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(g,{size:22,strokeWidth:1.5,style:c})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${k}`,style:c,children:S(r.name)})]})},r.name)})})})};export{O as default};
