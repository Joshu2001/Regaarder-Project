import{r as s,j as e,X as Y,E as g,e as f}from"./index-BOWuPlfO.js";import{A as B}from"./alert-circle-ua8o8pUY.js";function q({isOpen:A,onClose:j,onLoginSuccess:D}){const[h,v]=s.useState("login"),[d,b]=s.useState(!1),[C,n]=s.useState(""),[z,w]=s.useState(""),[p,k]=s.useState(!1),[c,I]=s.useState(!1),[x,R]=s.useState(!1),[E,L]=s.useState(null),[S,O]=s.useState(""),[a,y]=s.useState(null),[J,P]=s.useState(!1),[r,m]=s.useState({employeeId:"",password1:"",password2:"",password3:""}),[t,u]=s.useState({name:"",email:"",password1:"",password2:"",password3:""});s.useEffect(()=>{h==="signup"&&E===null&&N()},[h]);const N=async()=>{try{const i=await(await fetch("http://localhost:4000/staff/next-employee-id")).json();i.nextEmployeeId&&L(i.nextEmployeeId)}catch(o){console.error("Error fetching next employee ID:",o)}},F=async o=>{if(!o||!o.includes("@")){n("Please enter a valid email");return}P(!0);try{const l=await(await fetch("http://localhost:4000/staff/check-account-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})})).json();l.status==="approved"?y({status:"approved",message:`✅ ${l.message}`,type:"success",employeeId:l.employeeId}):l.status==="pending"?y({status:"pending",message:`⏳ ${l.message}`,type:"info"}):l.status==="denied"?y({status:"denied",message:`❌ ${l.message}`,type:"error"}):y({status:"not_found",message:`❓ ${l.message}`,type:"info"})}catch(i){n("Failed to check status"),console.error("Error checking account status:",i)}finally{P(!1)}};s.useEffect(()=>{if(a?.status==="pending"&&S){const o=setInterval(()=>{F(S)},3e3);return()=>clearInterval(o)}},[a?.status,S]);const T=async()=>{if(n(""),w(""),!r.employeeId||!r.password1||!r.password2||!r.password3){n("All fields are required");return}b(!0);try{const o=await fetch("http://localhost:4000/staff/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await o.json();if(!o.ok){n(i.error||"Login failed");return}localStorage.setItem("staffSession",JSON.stringify(i.employee)),D(i.employee),j()}catch(o){n("Connection error"),console.error(o)}finally{b(!1)}},W=async()=>{if(n(""),w(""),!t.name||!t.email||!t.password1||!t.password2||!t.password3){n("All fields are required");return}if(!t.email.includes("@")){n("Invalid email address");return}b(!0);try{const o=await fetch("http://localhost:4000/staff/create-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await o.json();if(!o.ok){n(i.error||"Signup failed");return}O(t.email),w("Account request submitted. Awaiting Executive approval."),F(t.email),u({name:"",email:"",password1:"",password2:"",password3:""})}catch(o){n("Connection error"),console.error(o)}finally{b(!1)}};return A?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"32px",width:"90%",maxWidth:"400px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"bold"},children:h==="login"?"Staff Login":"Create Staff Account"}),e.jsx("button",{onClick:j,style:{background:"none",border:"none",cursor:"pointer",padding:0},children:e.jsx(Y,{size:24})})]}),C&&e.jsxs("div",{style:{display:"flex",gap:"8px",padding:"12px",backgroundColor:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"8px",marginBottom:"16px",color:"#dc2626",fontSize:"14px",alignItems:"center"},children:[e.jsx(B,{size:18}),C]}),z&&e.jsx("div",{style:{padding:"12px",backgroundColor:"#dcfce7",border:"1px solid #86efac",borderRadius:"8px",marginBottom:"16px",color:"#16a34a",fontSize:"14px"},children:z}),a&&e.jsxs("div",{style:{padding:"12px",backgroundColor:a.type==="success"?"#dcfce7":a.type==="error"?"#fee2e2":"#dbeafe",border:a.type==="success"?"1px solid #86efac":a.type==="error"?"1px solid #fca5a5":"1px solid #7dd3fc",borderRadius:"8px",marginBottom:"16px",color:a.type==="success"?"#16a34a":a.type==="error"?"#dc2626":"#0369a1",fontSize:"14px"},children:[a.message,a.status==="pending"&&e.jsx("div",{style:{fontSize:"12px",marginTop:"8px",opacity:.8},children:"Checking status... (refreshes every 3 seconds)"})]}),h==="login"?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx("input",{type:"text",placeholder:"Employee ID",value:r.employeeId,onChange:o=>m({...r,employeeId:o.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:p?"text":"password",placeholder:"Password 1",value:r.password1,onChange:o=>m({...r,password1:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>k(!p),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:p?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:c?"text":"password",placeholder:"Password 2",value:r.password2,onChange:o=>m({...r,password2:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>I(!c),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:c?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:x?"text":"password",placeholder:"Password 3",value:r.password3,onChange:o=>m({...r,password3:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>R(!x),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:x?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsx("button",{onClick:T,disabled:d,style:{padding:"12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:d?"not-allowed":"pointer",opacity:d?.6:1},children:d?"Logging in...":"Login"}),e.jsxs("div",{style:{textAlign:"center",fontSize:"14px",color:"#666"},children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>v("signup"),style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Create one"})]})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",backgroundColor:"#f9fafb",color:"#666"},children:["Employee ID: ",e.jsx("strong",{children:E||"Loading..."})]}),e.jsx("input",{type:"text",placeholder:"Full Name",value:t.name,onChange:o=>u({...t,name:o.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsx("input",{type:"email",placeholder:"Email",value:t.email,onChange:o=>u({...t,email:o.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:p?"text":"password",placeholder:"Password 1",value:t.password1,onChange:o=>u({...t,password1:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>k(!p),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:p?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:c?"text":"password",placeholder:"Password 2",value:t.password2,onChange:o=>u({...t,password2:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>I(!c),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:c?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:x?"text":"password",placeholder:"Password 3",value:t.password3,onChange:o=>u({...t,password3:o.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>R(!x),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:x?e.jsx(g,{size:18}):e.jsx(f,{size:18})})]}),e.jsx("button",{onClick:W,disabled:d,style:{padding:"12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:d?"not-allowed":"pointer",opacity:d?.6:1},children:d?"Creating...":"Create Account"}),e.jsx("button",{onClick:()=>v("login"),style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Login"})]})]})}):null}export{q as S};
