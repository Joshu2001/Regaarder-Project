import{b as me,u as xe,r,j as e,g as a,L as H,X as D,E as y,e as p}from"./index-BNjitftg.js";import{clearWatchHistory as ue}from"./watchhistory-C59_YMa9.js";import{C as he}from"./chevron-left-BtIKktsD.js";import{D as ge,T as K}from"./trash-Bm_gLzso.js";import{M as Q}from"./mail-C0hNXWoI.js";import"./search-ht5lMr3J.js";import"./pencil-ZZR2JNjx.js";import"./history-Cl_ghgO2.js";import"./lightbulb-h_ZY1n6d.js";import"./check-circle-CF6a8YPX.js";import"./home-B7rtzrEK.js";const we=(l,x="English")=>{if(!l)return a("Unknown",x);try{const t=new Date(l).getTime(),u=Date.now(),h=Math.max(0,u-t),o=Math.floor(h/6e4),d=Math.floor(o/60),c=Math.floor(d/24),g=Math.floor(c/30);return g>0?`${g} month${g>1?"s":""} ago`:c>0?`${c} day${c>1?"s":""} ago`:d>0?`${d} hour${d>1?"s":""} ago`:`${o} minute${o!==1?"s":""} ago`}catch{return a("Unknown",x)}},De=()=>{const l=me(),x=xe(),[t]=r.useState(()=>{try{return localStorage.getItem("regaarder_language")||"English"}catch{return"English"}}),u=window&&window.__BACKEND_URL__||"http://localhost:4000",h=(()=>{try{return l.user||JSON.parse(localStorage.getItem("regaarder_user")||"{}")}catch{return{}}})(),o=(()=>{try{return localStorage.getItem("regaarder_token")}catch{return null}})(),[d,c]=r.useState(!1),[g,j]=r.useState(!1),[W,w]=r.useState(!1),[C,_]=r.useState(!1),[$,S]=r.useState(""),[X,T]=r.useState(!1),[b,O]=r.useState(""),[I,G]=r.useState(!1),[k,M]=r.useState(""),[N,L]=r.useState(""),[B,A]=r.useState(""),[E,V]=r.useState(h.email||""),[P,J]=r.useState(""),[R,Z]=r.useState(!1),[z,ee]=r.useState(!1),[U,se]=r.useState(!1),[q,te]=r.useState(!1),[m,v]=r.useState(!1),[Y,i]=r.useState(""),ae=async()=>{try{const s=localStorage.getItem("regaarder_user"),n=s?JSON.parse(s):{},de=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),F=URL.createObjectURL(de),f=document.createElement("a");f.href=F,f.download="regaarder-export.json",document.body.appendChild(f),f.click(),document.body.removeChild(f),setTimeout(()=>{try{URL.revokeObjectURL(F)}catch{}},150)}catch{}},re=()=>{S(""),T(!1),w(!0)},le=["watchHistory","miniPlayerData","requested_badge_seen","requests_swipe_entrance_shown","pinned_requests_v1","publishedItems","videoplayer_index","videoplayer_source","handleHintShownQuickOptions","watchIncognito","hasSeenRequests","fab_dismissed","welcome_selected_role","requests_search_query"],oe=async()=>{S(""),_(!0);try{if(o){const s=await fetch(`${u}/me/data`,{method:"DELETE",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({currentPassword:b})});if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.error||"Failed to delete data on server")}}try{try{ue()}catch{}le.forEach(s=>{try{localStorage.removeItem(s)}catch{}})}catch{}T(!0),w(!1)}catch(s){S(s.message||"Error")}finally{_(!1)}},ne=async()=>{if(window.confirm(a("Permanently delete your account?",t)))try{localStorage.removeItem("regaarder_user"),localStorage.removeItem("regaarder_token"),l&&l.logout&&l.logout(),x("/home")}catch{}},ce=async()=>{if(i(""),!k||!N||N!==B){i("Please fill all fields correctly");return}v(!0);try{const s=await fetch(`${u}/me/password`,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({currentPassword:k,newPassword:N})}),n=await s.json();if(!s.ok)throw new Error(n.error||"Failed");try{localStorage.setItem("regaarder_user",JSON.stringify(n.user))}catch{}l&&l.login&&l.login({...n.user,token:o}),c(!1),M(""),L(""),A("")}catch(s){i(s.message||"Error")}finally{v(!1)}},ie=async()=>{if(i(""),!E||!P){i("Please fill all fields");return}v(!0);try{const s=await fetch(`${u}/me/email`,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({newEmail:E,currentPassword:P})}),n=await s.json();if(!s.ok)throw new Error(n.error||"Failed");try{localStorage.setItem("regaarder_user",JSON.stringify(n.user))}catch{}l&&l.login&&l.login({...n.user,token:o}),j(!1),J("")}catch(s){i(s.message||"Error")}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center",children:[e.jsxs("div",{className:"w-full max-w-xl min-h-screen flex flex-col",style:{paddingBottom:"calc(80px + env(safe-area-inset-bottom))"},children:[e.jsx("header",{className:"bg-white border-b border-gray-100 p-4 sticky top-0 z-20",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(he,{className:"w-6 h-6 text-gray-700 cursor-pointer transition hover:text-gray-900",onClick:()=>{const s=localStorage.getItem("redirectBackTo");localStorage.removeItem("redirectBackTo"),x(s==="creatorDashboard"?"/creatordashboard":"/home")}}),e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:a("Settings",t)})]})}),e.jsxs("main",{className:"flex-grow p-4",children:[e.jsx("div",{className:"text-gray-900 text-lg font-semibold mb-3",children:a("Data & Account",t)}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden w-full max-w-md mx-auto mb-6",children:[e.jsx("button",{className:"w-full flex items-center justify-between px-4 py-4 hover:bg-gray-50 transition-colors",onClick:ae,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-6 h-6",style:{color:"var(--color-gold)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-medium text-gray-800",children:a("Export Your Data",t)}),e.jsx("div",{className:"text-sm text-gray-500",children:a("Download all your information",t)})]})]})}),e.jsx("div",{className:"h-px bg-gray-200 mx-4"}),e.jsx("button",{className:"w-full flex items-center justify-between px-4 py-4 hover:bg-gray-50 transition-colors",onClick:re,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"w-6 h-6",style:{color:"var(--color-gold)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-medium",style:{color:"var(--color-gold)"},children:a("Delete Your Data",t)}),e.jsx("div",{className:"text-sm text-gray-500",children:a("Delete all your data but keep your account",t)})]})]})}),e.jsx("div",{className:"h-px bg-gray-200 mx-4"}),e.jsx("button",{className:"w-full flex items-center justify-between px-4 py-4 hover:bg-gray-50 transition-colors",onClick:ne,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"w-6 h-6",style:{color:"var(--color-gold)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-medium",style:{color:"var(--color-gold)"},children:a("Delete Account",t)}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-gold)"},children:a("Permanently delete your account",t)})]})]})})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden w-full max-w-md mx-auto mb-4",children:e.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{className:"w-6 h-6",style:{color:"var(--color-gold)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-medium text-gray-800",children:a("Password",t)}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a("Last changed",t)," ",we(h.passwordChangedAt,t)]})]})]}),e.jsx("button",{className:"px-3 py-1.5 rounded-lg bg-gray-100 text-gray-800 text-sm font-semibold",onClick:()=>{i(""),c(!0)},children:a("Change",t)})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden w-full max-w-md mx-auto",children:e.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"w-6 h-6",style:{color:"var(--color-gold)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-medium text-gray-800",children:a("Email",t)}),e.jsx("div",{className:"text-sm text-gray-500",children:h.email||"â€”"})]})]}),e.jsx("button",{className:"px-3 py-1.5 rounded-lg bg-gray-100 text-gray-800 text-sm font-semibold",onClick:()=>{i(""),j(!0)},children:a("Change",t)})]})}),Y&&e.jsx("div",{className:"max-w-md mx-auto mt-3 bg-red-50 text-red-700 text-sm rounded-lg px-4 py-2",children:Y}),X&&e.jsx("div",{className:"max-w-md mx-auto mt-3 bg-green-50 text-green-700 text-sm rounded-lg px-4 py-2",children:a("Your data has been deleted",t)})]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:()=>c(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5",style:{color:"var(--color-gold)"}}),e.jsx("div",{className:"text-lg font-semibold",children:a("Change Password",t)})]}),e.jsx("button",{onClick:()=>c(!1),className:"p-2 text-gray-500",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:R?"text":"password",placeholder:a("Current password",t),value:k,onChange:s=>M(s.target.value),className:"w-full pr-10 p-3 bg-gray-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>Z(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 p-1",children:R?e.jsx(y,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:z?"text":"password",placeholder:a("New password",t),value:N,onChange:s=>L(s.target.value),className:"w-full pr-10 p-3 bg-gray-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>ee(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 p-1",children:z?e.jsx(y,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:U?"text":"password",placeholder:a("Confirm new password",t),value:B,onChange:s=>A(s.target.value),className:"w-full pr-10 p-3 bg-gray-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>se(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 p-1",children:U?e.jsx(y,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})]})]}),e.jsx("button",{disabled:m,onClick:ce,className:`mt-4 w-full py-3 rounded-lg text-black font-semibold ${m?"opacity-60":""}`,style:{backgroundColor:"var(--color-gold)"},children:m?a("Saving...",t):a("Save",t)})]})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:()=>j(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-5 h-5",style:{color:"var(--color-gold)"}}),e.jsx("div",{className:"text-lg font-semibold",children:a("Change Email",t)})]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 text-gray-500",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"email",placeholder:a("New email",t),value:E,onChange:s=>V(s.target.value),className:"w-full p-3 bg-gray-100 rounded-lg"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:q?"text":"password",placeholder:a("Current password",t),value:P,onChange:s=>J(s.target.value),className:"w-full pr-10 p-3 bg-gray-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>te(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 p-1",children:q?e.jsx(y,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})]})]}),e.jsx("button",{disabled:m,onClick:ie,className:`mt-4 w-full py-3 rounded-lg text-black font-semibold ${m?"opacity-60":""}`,style:{backgroundColor:"var(--color-gold)"},children:m?a("Saving...",t):a("Save",t)})]})}),W&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:a("Delete Your Data",t)}),e.jsx("button",{onClick:()=>w(!1),className:"p-2 text-gray-500",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-gray-700 mb-4",children:a("Delete all your data but keep your account",t)}),e.jsx("div",{className:"mb-3 text-sm text-gray-600",children:a("Please re-enter your password to confirm deleting your data",t)}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:I?"text":"password",placeholder:a("Current password",t),value:b,onChange:s=>O(s.target.value),className:"w-full pr-10 p-3 bg-gray-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>G(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 p-1",children:I?e.jsx(y,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})]})}),$&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:$}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{w(!1),O("")},className:"flex-1 py-2 rounded-lg border border-gray-200",children:a("Cancel",t)}),e.jsx("button",{disabled:C||!b,onClick:oe,className:`flex-1 py-2 rounded-lg text-white ${C||!b?"opacity-60":""}`,style:{backgroundColor:"var(--color-gold)"},children:C?a("Deleting...",t):a("Delete My Data",t)})]})]})})]})};export{De as default};
