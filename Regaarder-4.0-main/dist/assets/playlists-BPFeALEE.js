import{u as z,r as u,j as t,g as k}from"./index-BX6cCIG8.js";import{u as H}from"./navigation-6Vsz_RYN.js";import{C as W}from"./chevron-left-BBUF2zhN.js";import{P as R,M,F as _}from"./pencil-CMlCmQQe.js";import{B as O}from"./bookmark-Cs8wiftV.js";import{L as J}from"./lightbulb-DC3RSx7z.js";import{L as K}from"./list-plus-m5tUyPT-.js";import{H as V}from"./home-B21ic90c.js";const D="playlists_v1";function y(){try{const o=localStorage.getItem(D),r=o?JSON.parse(o):{lists:[]};return Array.isArray(r)?{lists:r}:{lists:Array.isArray(r.lists)?r.lists:[]}}catch{return{lists:[]}}}function w(o){try{localStorage.setItem(D,JSON.stringify({lists:o.lists||[]}))}catch{}try{window.dispatchEvent(new CustomEvent("playlists:updated"))}catch{}}function f(){return y().lists}function ce(o){w({lists:o})}function q(o){const r=y(),s=String(o||"Playlist").trim()||"Playlist";let a=r.lists.find(n=>n.name.toLowerCase()===s.toLowerCase());return a||(a={id:`pl_${Date.now()}`,name:s,items:[],createdAt:new Date().toISOString()},r.lists.unshift(a),w(r)),a}function G(o){return q(o)}function Q(o,r){const s=y(),a=s.lists.findIndex(n=>n.id===o);a>=0&&(s.lists[a]={...s.lists[a],name:String(r||"").trim()||s.lists[a].name},w(s))}function F(o){const r=y();r.lists=r.lists.filter(s=>s.id!==o),w(r)}function Y(o,r){if(!o||!r)return;const s=y(),a=s.lists.find(d=>d.id===o);if(!a)return;const n={id:String(r.id||r.videoId||r.url||r.src||Date.now()),url:r.url||r.src||r.videoUrl||null,title:r.title||"",thumbnail:r.imageUrl||r.thumbnail||"",author:r.author||"",requester:r.requester||"",addedAt:new Date().toISOString()};a.items.some(d=>String(d.id)===String(n.id))||a.items.unshift(n),w(s)}function Z(o,r){const s=y(),a=s.lists.find(n=>n.id===o);a&&(a.items=(a.items||[]).filter(n=>String(n.id)!==String(r)),w(s))}function de(){const o=z();H();const r=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",s=e=>k(e,r),[a,n]=u.useState(f()),[p,d]=u.useState(()=>a[0]?.id||null),[h,c]=u.useState("");u.useEffect(()=>{const e=()=>n(f());window.addEventListener("playlists:updated",e);const l=setInterval(e,8e3);return()=>{window.removeEventListener("playlists:updated",e),clearInterval(l)}},[]);const m=u.useMemo(()=>a.find(e=>e.id===p)||a[0]||null,[a,p]),[b,v]=u.useState(!1),[j,C]=u.useState(""),[S,T]=u.useState(""),[U,E]=u.useState(null),[L,I]=u.useState(""),N=u.useRef({}),$=()=>{C(""),T(""),v(!0)},X=()=>{const e=(j||"").trim();if(!e){T(s("Please enter a name"));return}if(a.some(g=>g.name.toLowerCase()===e.toLowerCase())){T(s("A playlist with this name already exists"));return}const x=G(e),i=f();n(i),d(x.id),v(!1)},P=()=>{v(!1)},A=(m?.items||[]).filter(e=>{const l=h.trim().toLowerCase();return l?(e.title||"").toLowerCase().includes(l)||(e.author||"").toLowerCase().includes(l)||(e.requester||"").toLowerCase().includes(l):!0}),B=e=>{const l=e.url||e.id;if(!l)return;const x=new URLSearchParams({src:l,title:e.title||""});window.location.href=`/videoplayer?${x.toString()}`};return t.jsxs("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:[t.jsxs("div",{className:"w-full flex flex-col bg-white overflow-hidden",children:[t.jsx("header",{className:"bg-white border-b border-gray-100 p-4 sticky top-0 z-20",children:t.jsxs("div",{className:"flex items-center space-x-4 justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(W,{className:"w-6 h-6 text-gray-700 cursor-pointer transition hover:text-gray-900",onClick:()=>o(-1)}),t.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:s("Playlist")})]}),t.jsx("button",{onClick:$,className:"text-sm font-medium hover:opacity-80 transition",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:s("New")})]})}),t.jsx("div",{className:"p-4 space-y-3 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[t.jsxs("svg",{className:"w-4 h-4 text-gray-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("path",{d:"m21 21-4.3-4.3"})]}),t.jsx("input",{value:h,onChange:e=>c(e.target.value),placeholder:s("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),t.jsx("select",{value:m?.id||"",onChange:e=>d(e.target.value),className:"ml-4 px-2 py-2 border border-gray-200 rounded-md text-sm",children:a.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))})]})}),t.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-6",children:[a.length>0&&t.jsx("div",{className:"w-full grid grid-cols-2 gap-4",children:a.map(e=>{const l=e.items&&e.items[0]&&(e.items[0].thumbnail||e.items[0].imageUrl)||"https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(s("Playlist")),x=e.id===m?.id;return t.jsxs("button",{onClick:i=>{if(i.currentTarget.dataset.longpressed==="1"){i.currentTarget.dataset.longpressed="0";return}d(e.id)},className:`w-full text-left bg-white rounded-2xl border ${x?"border-[var(--color-gold)]":"border-gray-200"} overflow-hidden hover:border-gray-300 transition`,onMouseDown:i=>{N.current[e.id]=setTimeout(()=>{try{if(i.currentTarget.dataset.longpressed="1",confirm(s("Delete this playlist?"))){F(e.id);const g=f();n(g),d(g[0]?.id||null)}}catch{}},700)},onMouseUp:i=>{clearTimeout(N.current[e.id])},onMouseLeave:i=>{clearTimeout(N.current[e.id])},onTouchStart:i=>{N.current[e.id]=setTimeout(()=>{try{if(i.currentTarget.dataset.longpressed="1",confirm(s("Delete this playlist?"))){F(e.id);const g=f();n(g),d(g[0]?.id||null)}}catch{}},700)},onTouchEnd:i=>{clearTimeout(N.current[e.id])},children:[t.jsx("div",{className:"w-full pb-[56%] relative",children:t.jsx("img",{src:l,alt:e.name,className:"absolute inset-0 w-full h-full object-cover",onError:i=>{i.currentTarget.src="https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(s("Playlist"))}})}),t.jsxs("div",{className:"px-3 py-2 relative",children:[U===e.id?t.jsx("input",{autoFocus:!0,value:L,onChange:i=>I(i.target.value),onBlur:()=>{try{Q(e.id,(L||"").trim()||e.name),n(f())}catch{}E(null)},onKeyDown:i=>{i.key==="Enter"&&i.currentTarget.blur()},className:"w-full text-base font-semibold text-gray-900 truncate outline-none"}):t.jsx("div",{className:"text-base font-semibold text-gray-900 truncate",children:e.name}),t.jsx("button",{onClick:i=>{i.stopPropagation(),E(e.id),I(e.name||"")},className:"absolute top-2 right-2 p-1 text-gray-600 hover:text-gray-900",children:t.jsx(R,{className:"w-4 h-4"})}),t.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[t.jsx("span",{children:s("Private")}),t.jsx("span",{children:"•"}),t.jsx("span",{children:(e.items||[]).length}),t.jsx(O,{className:"w-3.5 h-3.5 ml-auto text-gray-400"})]})]})]},e.id)})}),m?A.length>0?t.jsx("div",{className:"w-full space-y-4",children:A.map(e=>t.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>B(e),onTouchStart:l=>{l.currentTarget.dataset.startX=l.touches[0].clientX},onTouchMove:l=>{const x=parseFloat(l.currentTarget.dataset.startX||"0"),i=l.touches[0].clientX-x;l.currentTarget.style.transform=`translateX(${i}px)`},onTouchEnd:l=>{const x=parseFloat(l.currentTarget.dataset.startX||"0"),i=l.changedTouches[0].clientX-x;l.currentTarget.style.transform="",i<-80&&(Z(m.id,e.id),n(f())),l.currentTarget.dataset.startX="0"},children:[t.jsx("img",{src:e.thumbnail||"https://placehold.co/160x90/efefef/777?text=Video",alt:e.title,className:"w-40 h-24 object-cover rounded-md",onError:l=>{l.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title||e.url||e.id}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[e.author,e.author&&e.requester?" • ":"",e.requester]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Added • ",new Date(e.addedAt).toLocaleString()]})]}),t.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:l=>{l.stopPropagation();const x=e.url?`${window.location.origin}/videoplayer?src=${encodeURIComponent(e.url)}&title=${encodeURIComponent(e.title||"")}`:window.location.href,i={title:e.title||"Watch this",text:e.title||"Watch this",url:x};if(navigator.share)navigator.share(i).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(x),alert(s("Share link copied"))}catch{}},children:t.jsx(M,{className:"w-5 h-5"})})]},`${m.id}:${e.id}`))}):t.jsxs("div",{className:"w-full space-y-3",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[s("Playlist")," “",m.name,"” ",s("has no videos yet")]}),t.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,138,0,0.06)"},children:[t.jsx(J,{className:"w-4 h-4 mt-0.5 text-[var(--color-gold)] flex-shrink-0"}),t.jsx("p",{className:"text-xs leading-relaxed font-medium",children:s("Use “Add to playlist” from a video’s options to start filling this list. Swipe left on items to remove.")})]})]}):t.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center space-y-4 pt-8",children:[t.jsx(K,{className:"w-16 h-16 text-gray-400",strokeWidth:1}),t.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:s("No playlists yet")}),t.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:s("Create your first playlist to organize favorite videos")})]})]}),t.jsx(ee,{})]}),b&&t.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:P,children:t.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("Create Playlist")}),t.jsx("button",{className:"p-1 text-gray-500 hover:text-gray-700",onClick:P,children:"✕"})]}),t.jsx("label",{className:"text-sm text-gray-700",children:s("Name")}),t.jsx("input",{value:j,onChange:e=>{C(e.target.value),T("")},placeholder:s("My Playlist"),className:"mt-1 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md outline-none"}),S&&t.jsx("div",{className:"text-xs text-red-600 mt-1",children:S}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 text-sm text-gray-700",onClick:P,children:s("Cancel")}),t.jsx("button",{className:"px-3 py-2 text-sm text-white rounded-md",style:{backgroundColor:"var(--color-gold)"},onClick:X,children:s("Create")})]})]})})]})}const ee=()=>{const o=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",r=c=>k(c,o),[s,a]=u.useState(null),n=u.useRef(!1),p=[{id:"Home",name:r("Home"),icon:V},{id:"Requests",name:r("Requests"),icon:_},{id:"Ideas",name:r("Ideas"),icon:R},{id:"More",name:r("More"),icon:M}],d="rgb(107 114 128)",h=c=>{try{if(c==="Home"){window.location.href="/home.jsx";return}if(c==="Requests"){window.location.href="/requests.jsx";return}if(c==="Ideas"){window.location.href="/ideas.jsx";return}if(c==="More"){window.location.href="/more.jsx";return}}catch(m){console.warn("Navigation failed",m)}};return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-50 border-t border-gray-200 shadow-2xl z-10",style:{paddingTop:"10px",paddingBottom:"calc(44px + env(safe-area-inset-bottom))"},children:t.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:p.map(c=>{const m=c.id===s,b=m?{color:"var(--color-gold)"}:{color:d},v=m?"font-semibold":"font-normal";let j={};m&&(j.textShadow="0 0 8px var(--color-gold-light)");const C=c.icon;return t.jsx("div",{className:"relative flex flex-col items-center w-1/4 focus:outline-none",style:j,children:t.jsxs("button",{className:"flex flex-col items-center w-full",onMouseDown:()=>{a(c.id),n.current||(n.current=!0,h(c.id))},onTouchStart:()=>{a(c.id),n.current||(n.current=!0,h(c.id))},onClick:S=>{if(n.current){n.current=!1,S.preventDefault();return}a(c.id),h(c.id)},children:[t.jsx("div",{className:"w-11 h-11 flex items-center justify-center",children:t.jsx(C,{size:22,strokeWidth:1.5,style:b})}),t.jsx("span",{className:`text-[11px] md:text-xs mt-0 leading-none ${v}`,style:b,children:c.name})]})},c.id)})})})};async function me(o){const r=typeof window<"u"&&window.localStorage.getItem("regaarder_language")||"English",s=a=>k(a,r);try{const n=f().map(c=>c.name),p=s("Add to playlist")+`:
`+(n.length?s("Existing: ")+n.join(", "):s("No playlists yet")),d=prompt(p,n[0]||s("My Playlist"));if(!d)return!1;const h=q(d);return Y(h.id,o),!0}catch{return!1}}export{Y as addToPlaylist,G as createPlaylist,de as default,F as deletePlaylist,q as ensurePlaylist,f as getPlaylists,me as promptAddToPlaylist,Z as removeFromPlaylist,Q as renamePlaylist,ce as setPlaylists};
